/*
Copyright (c) 2015 NAVER Corp.
name: @egjs/infinitegrid
license: MIT
author: NAVER Corp.
repository: https://github.com/naver/egjs-infinitegrid
version: 3.6.3
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@egjs/component"),require("@egjs/list-differ"),require("@egjs/lazyloaded")):"function"==typeof define&&define.amd?define(["@egjs/component","@egjs/list-differ","@egjs/lazyloaded"],e):(t.eg=t.eg||{},t.eg.InfiniteGrid=e(t.eg.Component,t.eg.ListDiffer,t.eg.LazyLoaded))}(this,function(g,d,f){"use strict";var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function i(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var u,t,p=function(){return(p=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},h=(u="undefined"==typeof window?{document:{},navigator:{userAgent:""}}:window).document,e=u.navigator.userAgent,r=!!("getComputedStyle"in u),s=!!("addEventListener"in h),o=function(){var t=!1;try{s&&Object.defineProperty&&h.addEventListener("test",function(){},Object.defineProperty({},"passive",{get:function(){t=!0}}))}catch(t){}return t}(),_=(/MSIE|Trident|Windows Phone|Edge/.test(e),/iPhone|iPad/.test(e)),v=/Android 2\./.test(e),a="_eg-infinitegrid-container_",z="_eg-infinitegrid-ignore_",c="_INFINITEGRID_TRANSITION",l="vertical",m="horizontal",B=-1e5,y="data-groupkey",S={itemSelector:"*",isOverflowScroll:!1,threshold:100,isEqualSize:!1,isConstantSize:!1,useRecycle:!0,horizontal:!1,transitionDuration:0,useFit:!0,attributePrefix:"data-",renderExternal:!1},w={horizontal:!1,margin:0},M=e.toLowerCase(),C=(/mobi|ios|android/.test(M),"start"),E="center",I="end",x="justify",L=/applewebkit\/([\d|.]*)/g.exec(M),P=L&&parseInt(L[1],10)||0,O=P&&P<537,T=["content","groupKey","itemKey","orgSize","mounted","prevRect","rect","size"],A=(t=function(){var t={transitionend:"",webkitTransitionEnd:"-webkit-",MSTransitionEnd:"-ms-",oTransitionEnd:"-o-",mozTransitionEnd:"-moz-"};for(var e in t){var i=t[e];if("on"+e.toLowerCase()in u)return[i+"transform",i+"transition",e]}return[]}())[0],b=t[1],G=t[2],K={getLoadingBar:!0,getItem:!0,getItems:!0,layout:!0,getGroupKeys:!0,getStatus:!0,setStatus:!0,isProcessing:!0,startLoading:!0,endLoading:!0,isLoading:!0,updateItem:!0,updateItems:!0,moveTo:!0};function R(t){var e=[];if(t)for(var i=t.length,n=0;n<i;n++)e.push(t[n]);return e}function k(t){return t.match(/^<([A-z]+)\s*([^>]*)>/)}function q(t,e){var i;if(void 0===e&&(e=!1),"string"!=typeof t)return tt(t)?i=t:!function(t){return"function"==typeof u.jQuery&&t instanceof u.jQuery||t.constructor.prototype.jquery&&t.toArray}(t)?Array.isArray(t)?(i=t.map(function(t){return q(t)}),e||(i=1<=i.length?i[0]:void 0)):i=!t.nodeName||1!==t.nodeType&&9!==t.nodeType?[].slice.call(i):t:i=e?q(t.toArray(),!0):q(t.get(0),!1),i;if(k(t)){var n=h.createElement("div");n.innerHTML=t,i=n.childNodes}else i=h.querySelectorAll(t);return e?R(i):i&&i[0]}function F(t,e,i,n){if(s){var r=n||!1;"object"==typeof n&&(r=!!o&&n),t.addEventListener(e,i,r)}else t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i}function N(t,e,i){t.removeEventListener?t.removeEventListener(e,i,!1):t.detachEvent?t.detachEvent("on"+e,i):t["on"+e]=null}function V(t){return(r?u.getComputedStyle(t):t.currentStyle)||{}}function j(t,e,i){if(tt(t))return u["inner"+e]||h.body["client"+e];if(function(t){return 9===t.nodeType}(t)){var n=t.documentElement,r=t.body;return Math.max(r["scroll"+e],n["scroll"+e],r["offset"+e],n["offset"+e],n["client"+e])}var s=0;if(i){var o=t.getBoundingClientRect();s="Width"===e?o.right-o.left:o.bottom-o.top}else s=t["client"+e]||t["offset"+e];if(s)return s;var a=V(t)[e.toLowerCase()];return~a.indexOf("px")&&parseFloat(a)||0}function H(t){return j(t,"Width",!1)}function D(t){return j(t,"Height",!1)}function W(t){return j(t,"Width",!0)}function X(t){return j(t,"Height",!0)}function Y(t){return{width:W(t),height:X(t)}}var U={vertical:{startPos1:"top",endPos1:"bottom",size1:"height",startPos2:"left",endPos2:"right",size2:"width"},horizontal:{startPos1:"left",endPos1:"right",size1:"width",startPos2:"top",endPos2:"bottom",size2:"height"}};function Q(t){return U[t?m:l]}function $(i){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return t.forEach(function(t){for(var e in t)i[e]=t[e]}),i}function J(t,e){return $({},w,t,e)}function Z(t){return t.map(function(t){return $({},t)})}function tt(t){return t===u}function et(t,e){for(var i=t.length-1;0<=i;--i)t[i]=e;return t}function it(t){return void 0===t}function nt(t){var n=[],r={};return t.forEach(function(t){var e=t.groupKey,i=r[e];i||(i={groupKey:e,items:[]},r[e]=i,n.push(i)),i.items.push(t)}),n}var rt=function(){function r(){this._groups=[],this._groupKeys={}}var t=r.prototype;return r.toItems=function(t,e){return t.map(function(t){return function(t,e){return{el:e,groupKey:t,mounted:!1,content:e?e.outerHTML:"",rect:{top:B,left:B}}}(e,t)})},r.pluck=function(t,i){return t.reduce(function(t,e){return t.concat(e[i])},[])},t.clear=function(){this._groups=[],this._groupKeys={}},t.getStatus=function(t,e){var i=this._groups,n=Math.max(this.indexOf(t),0),r=this.indexOf(e)+1||i.length;return{_data:i.slice(n,r).map(function(t){var e=t.items.map(function(e){var i={};return T.forEach(function(t){t in e&&(i[t]=e[t])}),i}),i=$({},t);return i.items=e,i})}},t.setStatus=function(t){var i=this,e=t._data;this.clear(),e.forEach(function(t,e){i.insertGroup(t,e)})},t.size=function(){return this._groups.length},t.fit=function(n,t){var e=this._groups;if(e.length){var r=t?"left":"top";0!==n&&e.forEach(function(t){var e=t.items,i=t.outlines;e.forEach(function(t){t.rect[r]-=n}),i.start=i.start.map(function(t){return t-n}),i.end=i.end.map(function(t){return t-n})})}},t.pluck=function(t,e,i){var n=it(e)?this._groups:this.sliceGroups(e,(it(i)?e:i)+1);return r.pluck(n,t)},t.getOutline=function(t,e){var i=this._groups[t];return i?i.outlines[e]:[]},t.getEdgeIndex=function(t,e,i){for(var n="start"===t?"min":"max",r=-1,s="start"===t?1/0:-1/0,o=e;o<=i;o++){var a=Math[n].apply(Math,this.getOutline(o,t));("start"===t&&a<s||"end"===t&&s<a)&&(s=a,r=o)}return r},t.getEdgeValue=function(t,e,i){var n=this.getGroup(this.getEdgeIndex(t,e,i));if(n){var r=n.outlines[t];if(r.length)return Math["start"===t?"min":"max"].apply(Math,r)}return 0},t.clearOutlines=function(i,n){void 0===i&&(i=-1),void 0===n&&(n=-1),this.getGroups().forEach(function(t,e){i<=e&&e<=n||(t.items.forEach(function(t){t.rect.top=B,t.rect.left=B}),t.outlines.start=[],t.outlines.end=[])})},t.getMaxEdgeValue=function(){for(var t=this._groups,e=t.length-1;0<=e;--e){var i=t[e].outlines.end;if(i.length)return Math.max.apply(Math,i)}return 0},t.prependGroup=function(t){return this.insertGroup(t,0)},t.appendGroup=function(t){return this.insertGroup(t,this._groups.length)},t.insertGroup=function(t,i){var n=this;if(i<0)return null;var e=t.items||[],r=p({outlines:{start:[],end:[]}},t,{items:[]});return this._groups.splice(i,0,r),this._groupKeys[r.groupKey]=r,e.forEach(function(t,e){n.insert(t,i,e)}),r},t.sync=function(t){var i=this,n=this._groups,r=this._groupKeys,s=nt(t),e=d.diff(n,s,function(t){return t.groupKey}),o=e.removed,a=e.added,u=e.maintained;o.forEach(function(t){var e=n[t];e&&delete r[e.groupKey]});var h=[];return u.forEach(function(t){var e=t[0];h.push(n[e])}),this._groups=h,a.forEach(function(t){i.insertGroup(s[t],t)}),u.reverse().forEach(function(t){var e=t[1];i.syncItems(e,s[e].items)}),e},t.insert=function(t,e,i){void 0===e&&(e=-1),void 0===i&&(i=-1);var n=t.groupKey,r=this._groups,s=this._groupKeys,o=(-1<e?r[e]:s[n])||this.insertGroup({groupKey:n},e);if(!o)return null;var a=p({content:"",mounted:!1,rect:{top:B,left:B}},t),u=o.items;return-1===i?u.push(a):u.splice(i,0,a),a},t.removeGroup=function(t){var e=this._groups.splice(t,1)[0];return e?(delete this._groupKeys[e.groupKey],e):null},t.remove=function(t,e){var i=this.getGroup(t),n=null,r=[];return i&&(r=i.items.splice(e,1),i.items.length||(n=this.removeGroup(t))),{items:r,group:n}},t.indexOf=function(t){if(void 0===t)return-1;for(var e=""+("object"==typeof t?t.groupKey:t),i=this._groups,n=i.length,r=0;r<n;++r)if(e==""+i[r].groupKey)return r;return-1},t.indexesOfElement=function(t){var e=t.getAttribute(y),i=this.indexOf({groupKey:e}),n=-1;if(-1<i)for(var r=this.getGroup(i),s=r.items.length,o=0;o<s;o++)if(r.items[o].el===t){n=o;break}return{groupIndex:i,itemIndex:n}},t.sliceGroups=function(t,e){return this._groups.slice(t,e)},t.getGroups=function(){return this._groups},t.getGroupByKey=function(t){return this._groupKeys[t]},t.getGroup=function(t){return this._groups[t]},t.syncItems=function(e,r){var i=this;if(r.length){var s=this.getGroup(e).items,t=d.diff(s,r,function(t){return t.itemKey}),n=t.added,o=t.maintained,a=this._groups[e],u=[];o.forEach(function(t){var e=t[0],i=t[1],n=s[e];$(n,r[i]),u.push(n)}),a.items=u,n.forEach(function(t){i.insert(r[t],e,t)})}else this.removeGroup(e)},r}();function st(t){t[b+"-property"]="",t[b+"-duration"]="",t[A]=""}function ot(t,e,i){t.forEach(function(t){t in e&&(i[t]=e[t]+"px")})}var at=function(){function s(t,e){this.options={isEqualSize:!1,isConstantSize:!1,horizontal:!1,container:!1},this._size={container:-1,view:-1,viewport:-1,item:null},this._orgStyle={},$(this.options,e),this._init(t),this.resize()}var t=s.prototype;return s.renderItem=function(e,t,i){if(e.el){var n=e.el,r=e.prevRect,s=n.style;if(n.setAttribute(y,""+e.groupKey),s.position="absolute",ot(["width","height"],t,s),i&&b&&r){if(function(t,e,i,n){e?i.left===n.left&&i.top===n.top||(t[b+"-property"]=A+",width,height",t[b+"-duration"]=e+"s",t[A]="translate("+(i.left-n.left)+"px,"+(i.top-n.top)+"px)"):st(t)}(s,i,t,r),n[c])return;n[c]=!0,function(e,i,n,t){var r=function(t){N(e,i,r),n(t)};F(e,i,r,t)}(n,G,function(){var t=e.rect;st(s),ot(["left","top"],t,s),e.prevRect=t,n[c]=!1})}else ot(["left","top"],t,s),e.prevRect=t}},s.renderItems=function(t,e){t.forEach(function(t){s.renderItem(t,t.rect,e)})},s.removeItems=function(t){t.forEach(function(t){t.el&&(s.removeElement(t.el),t.el=null)})},s.removeElement=function(t){var e=t&&t.parentNode;e&&e.removeChild(t)},s.createElements=function(t){if(t.length){var e=t.filter(function(t){return!t.el});if(e.length){var i=q(e.map(function(t){return t.content.replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g,"")}).join(""),!0);e.forEach(function(t,e){t.el=i[e]})}}},t.getStatus=function(){return{cssText:this.container.style.cssText,_size:$({},this._size)}},t.setStatus=function(t){this.container.style.cssText=t.cssText,$(this._size,t._size)},t.updateSize=function(t){var e=this.options,i=e.isEqualSize,n=e.isConstantSize,r=this._size;return t.map(function(t){return t.el&&(i&&!r.item&&(r.item=Y(t.el)),t.size=i&&$({},r.item)||n&&t.orgSize&&t.orgSize.width&&$({},t.orgSize)||Y(t.el),t.orgSize&&t.orgSize.width&&t.orgSize.height||(t.orgSize=$({},t.size))),t})},t.createAndInsert=function(t,e){s.createElements(t),s.renderItems(t),this._insert(t,e)},t.getViewSize=function(){return this._size.view},t.getViewportSize=function(){return this._size.viewport},t.getContainerSize=function(){return this._size.container},t.setContainerSize=function(t){this._size.container=t,this.container.style[this.options.horizontal?"width":"height"]=t+"px"},t.resize=function(){var t=this.options.horizontal,e=this.view,i=this._calcSize();if(0!==i){var n=i!==this._size.viewport;return n&&(this._size={view:-1,container:-1,viewport:i,item:null}),this._size.view=t?H(e):D(e),n}},t.isNeededResize=function(){return this._calcSize()!==this._size.viewport},t.clear=function(){this.container.innerHTML="",this.container.style[this.options.horizontal?"width":"height"]="",this._size={item:null,viewport:-1,container:-1,view:-1}},t.destroy=function(){this.clear();var t,e=this.options.container;for(t in this._orgStyle)this[e?"view":"container"].style[t]=this._orgStyle[t];e&&this.container.parentNode.removeChild(this.container)},t._init=function(t){var e=q(t),i=V(e),n=this.options,r=n.container,s=n.horizontal;if("static"===i.position&&(this._orgStyle.position=e.style.position,e.style.position="relative"),r){var o=s?["X","Y"]:["Y","X"];this._orgStyle.overflowX=e.style.overflowX,this._orgStyle.overflowY=e.style.overflowY,e.style["overflow"+o[0]]="scroll",e.style["overflow"+o[1]]="hidden",this.view=e,this.container=!0===r?function(t){var e=t.querySelector("."+a);if(e)return e.style.position="relative",e.style.height="100%",e;var i=h.createElement("div");i.className=a,i.style.position="relative",i.style.height="100%";for(var n=t.children,r=n.length,s=0;s<r;s++)i.appendChild(n[0]);return t.appendChild(i),i}(this.view):r}else this.view=u,this.container=e},t._insert=function(t,e,i){var n=this.container,r=h.createDocumentFragment();t.forEach(function(t){i&&s.renderItem(t,i),e?r.appendChild(t.el):r.insertBefore(t.el,r.firstChild)}),e?n.appendChild(r):n.insertBefore(r,n.firstChild)},t._calcSize=function(){return this.options.horizontal?D(this.container):H(this.container)},s}();var ut=function(){function t(t,e){this.options=$({useRecycle:!0,threshold:100,append:function(){},prepend:function(){},recycle:function(){}},e),this._itemManager=t,this.clear()}var e=t.prototype;return e.setSize=function(t){this._status.size=t},e.sync=function(t){var e=this._status,i=e.startCursor,n=e.endCursor,r=this._itemManager,s=r.sliceGroups(i,n+1),o=rt.pluck(s,"items"),a=r.sync(t),u=function(t,e){for(var i=t.length,n=0;n<i;++n)if(e(t[n]))return t[n];return null}(s,function(t){var e=t.groupKey;return r.getGroupByKey(e)}),h=function(t,e){for(var i=t.length-1;0<=i;--i)if(e(t[i]))return t[i];return null}(s,function(t){var e=t.groupKey;return r.getGroupByKey(e)}),c=u?r.indexOf(u):-1,l=h?r.indexOf(h):-1;if(-1<c&&-1<l){var f=Math.min(c,l),p=Math.max(c,l);c=f,l=p}else-1<l?c=l:-1<c&&(l=c);if(e.startCursor=c,e.endCursor=l,0<a.removed.length)return"relayout";var g=r.pluck("items",i,n);return 0<d.diff(o,g,function(t){return t.itemKey}).removed.length?"layout":""},e.recycle=function(e,t){if(this.options.useRecycle&&"number"==typeof e){var i=this._status,n=i.startCursor,r=i.endCursor,s=i.size;if(-1!==n&&-1!==r){var o=e+s,a=this.options,u=a.threshold,h=a.recycle,c=this._itemManager.sliceGroups(n,r+1).map(function(t){return function(t,e,i,n){var r=t.items,s=t.outlines,o=s.start,a=s.end;if(0===o.length||0===a.length||!r.length||!r[0].el)return 2;var u=Math.min.apply(Math,o),h=Math.max.apply(Math,a);return n+e<u?1:h<i-e?-1:0}(t,u,e,o)}),l=c.length,f=t?0:c.lastIndexOf(0),p=t?c.indexOf(0)-1:c.length-1;t||-1===f||(f+=1),f<0||p<0||p<f||l<=p-f+1||(f=n+f,p=n+p,t?this.setCursor("start",p+1):this.setCursor("end",f-1),h({start:f,end:p}))}}},e.scroll=function(a){var t=this.getCursors(),e=t[0],i=t[1],n=this._itemManager;if("number"==typeof a&&-1!==e&&-1!==i&&n.size()){var r=this._status.size,s=this.options,u=s.threshold,o=s.append,h=s.prepend,c=n.getGroups(),l=a+r,f=Math.max.apply(Math,c[e].outlines.start),p=Math.min.apply(Math,c[i].outlines.end),g=c.map(function(t,e){var i=t.outlines,n=i.start,r=i.end;if(!n.length||!r.length)return!1;var s=Math.min.apply(Math,n),o=Math.max.apply(Math,r);return s-u<=l&&a<=o+u}),d=g.indexOf(!0),_=g.lastIndexOf(!0);if(~d&&d<e)h({cache:c.slice(d,Math.min(e,_+1))});else if(i<_)o({cache:c.slice(Math.max(d,i+1),_+1)});else{var v=c.slice(i+1,i+2),m=c.slice(e-1,e),y=a<=f+u;p-u<=l&&(!y||v.length||!m.length)?o({cache:v}):y&&h({cache:m})}}},e.setCursor=function(t,e){var i=this._status,n=this._itemManager,r=n.size();if(!this.options.useRecycle){if(i.startCursor=0,n.getOutline(r-1,"end").length)return void(i.endCursor=r-1);if("end"!==t)return}"start"===t?i.startCursor=e:i.endCursor=Math.min(r-1,e),i.startCursor=Math.max(0,i.startCursor)},e.setStatus=function(t){this._status=$(this._status,t)},e.getStatus=function(t,e){var i=this._status,n=i.startCursor,r=i.endCursor,s=i.size,o=Math.max(this._itemManager.indexOf(t),0),a=(this._itemManager.indexOf(e)+1||this._itemManager.size())-1,u=Math.max(n-o,~n?0:-1);return{startCursor:u,endCursor:Math.max(Math.min(r-o,a-o),u),size:s}},e.getEdgeOutline=function(t){var e=this._status,i=e.startCursor,n=e.endCursor;return-1===i||-1===n?[]:this._itemManager.getOutline("start"===t?i:n,t)},e.getEdgeValue=function(t){var e=this.getEdgeOutline(t);return e.length?Math["start"===t?"min":"max"].apply(Math,e):0},e.getVisibleItems=function(){var t=this._status,e=t.startCursor,i=t.endCursor;return this._itemManager.pluck("items",e,i)},e.getCursors=function(){var t=this._status;return[t.startCursor,t.endCursor]},e.getCursor=function(t){return this._status["start"===t?"startCursor":"endCursor"]},e.getVisibleData=function(){var t=this._status,e=t.startCursor,i=t.endCursor;return this._itemManager.sliceGroups(e,i+1)},e.remove=function(t,e){var i=this._status,n=this._itemManager,r=i.startCursor,s=i.endCursor,o=n.remove(t,e);return o.group&&(t<r&&this.setCursor("start",r-1),t<=s&&this.setCursor("end",s-1)),n.size()||(i.startCursor=-1,i.endCursor=-1),o},e.clear=function(){this._status={startCursor:-1,endCursor:-1,size:-1}},t}();function ht(t,e){return~t.indexOf(e)}var ct=function(){function t(t,e,i,n){this._infinite=t,this._itemManager=e,this._renderer=i,this.options=n}var e=t.prototype;return e.setLayout=function(t){this._layout=t},e.render=function(n,t,r,e){var s=this;void 0===r&&(r=rt.pluck(t,"items"));var i=e?t:t.reverse(),o=[],a=[],u=r.map(function(t){return t.el}),h=this.options.attributePrefix;return f.check(u,h).on("ready",function(){s._itemManager&&s._complete(n,i,r,e)}).on("error",function(t){var e=t.target,i=t.itemIndex;s._itemManager&&s._error(n,a,o,e,r,i)}).on("finish",function(){s._itemManager&&s._end(n,a,o,r)}),n},e._complete=function(t,e,i,r){var n=this._infinite,s=this._layout,o=this._itemManager,a=r?"end":"start",u=o.indexOf(e[0]),h=o.getGroup(u+(r?-1:1)),c=h?h.outlines[a]:[0];this._renderer.updateSize(i),e.forEach(function(t){var i=t.outlines[r?"start":"end"];if(!(!c.length||c.length!==i.length||!c.every(function(t,e){return t===i[e]})))return c=t.outlines[r?"end":"start"],void at.renderItems(t.items);var e=t.items,n=s[r?"append":"prepend"](e,c,!0);$(t,n),at.renderItems(n.items),c=n.outlines[r?"end":"start"]});var l=Math.max(n.getCursor("start"),0),f=Math.max(n.getCursor("end"),0),p=o.indexOf(e[0].groupKey),g=o.indexOf(e[e.length-1].groupKey),d=!0;if((f+1<p||g<l-1)&&(d=!1),d&&(g=r?(p=l,Math.max(f,g)):(p=Math.max(Math.min(l,p),0),f)),g<p){var _=p;p=g,g=_}t.trigger("renderComplete",{start:p,end:g}),t.trigger("layoutComplete",{items:rt.pluck(e,"items"),isAppend:r})},e._error=function(t,i,n,r,e,s){function o(){if(!ht(i,h)){i.push(h);var t=n.indexOf(s);-1!==t&&n.splice(t,1)}}var a=this._itemManager,u=e[s],h=u.el,c=this.options.attributePrefix,l=a.pluck("items").indexOf(u);t.trigger("imageError",{target:r,element:h,items:e,item:u,itemIndex:s,replace:function(t){if(!ht(i,h)){if(t)if(k(t)||"object"==typeof t){var e=r.parentNode;e.insertBefore(q(t),r),e.removeChild(r),u.content=h.outerHTML}else r.src=t,r.getAttribute(c+"width")&&(f.removeAutoSizer(r,c),r.removeAttribute(c+"width"),r.removeAttribute(c+"height"));u.content=h.outerHTML,ht(n,s)||n.push(s)}},replaceItem:function(t){ht(i,h)||(h.innerHTML=t,u.content=h.outerHTML,ht(n,s)||n.push(s))},remove:function(){r!==h?ht(i,h)||(r.parentNode.removeChild(r),u.content=h.outerHTML,ht(n,s)||n.push(s)):o()},removeItem:o,totalIndex:l})},e._end=function(t,e,i,n){var r=this,s=this.options.attributePrefix,o=e.length,a=i.length;if(o||a){var u=i.map(function(t){return n[t]});a?f.check(u.map(function(t){return t.el}),s).on("ready",function(){r._renderer.updateSize(u),t.trigger("finish",{remove:e,layout:!0})}):t.trigger("finish",{remove:e,layout:!0})}else t.trigger("finish",{remove:[]})},t}(),lt=function(){function t(t,e){void 0===e&&(e={});var n=this;this._containerOffset=0,this._isScrollIssue=_,this._prevPos=null,this._onCheck=function(){var t=n.getScrollPos(),e=n.getOrgScrollPos();n.setScrollPos(e);var i=n.getScrollPos();null===t||n._isScrollIssue&&0===e||t===i?e&&(n._isScrollIssue=!1):(n._isScrollIssue=!1,n.options.check({isForward:t<i,scrollPos:i,orgScrollPos:e,horizontal:n.options.horizontal}))},this._onResize=function(){n._timer.resize&&clearTimeout(n._timer.resize),n._timer.resize=setTimeout(function(){n.resize(),n.options.resize(),n._timer.resize=null},100)},$(this.options={container:t,resize:function(){},check:function(){},isOverflowScroll:!1,horizontal:!1},e),this._timer={resize:null},this._view=t,this.attachEvent(),this.resize(),this.setScrollPos()}var e=t.prototype;return e.getStatus=function(){return{_prevPos:this._prevPos,scrollPos:this.getOrgScrollPos()}},e.setStatus=function(t,e){void 0===e&&(e=!0),this._prevPos=t._prevPos,e&&this.scrollTo(t.scrollPos)},e.scrollBy=function(t){var e=this.options.horizontal?[t,0]:[0,t];!function(t,e,i){tt(t)?t.scrollBy(e,i):(t.scrollLeft+=e,t.scrollTop+=i)}(this._view,e[0],e[1]),this.setScrollPos()},e.scrollTo=function(t){var e=this.options.horizontal?[t,0]:[0,t];!function(t,e,i){tt(t)?t.scroll(e,i):(t.scrollLeft=e,t.scrollTop=i)}(this._view,e[0],e[1])},e.getScrollPos=function(){return this._prevPos},e.setScrollPos=function(t){void 0===t&&(t=this.getOrgScrollPos()),this._prevPos=t-this.getContainerOffset()},e.attachEvent=function(){F(this._view,"scroll",this._onCheck),F(u,"resize",this._onResize)},e.getOrgScrollPos=function(){return function(t,e){void 0===e&&(e=!1);var i="scroll"+(e?"Left":"Top");return tt(t)?u[e?"pageXOffset":"pageYOffset"]||h.body[i]||h.documentElement[i]:t[i]}(this._view,this.options.horizontal)},e.reset=function(){this._prevPos=null},e.getContainerOffset=function(){return this._containerOffset},e.resize=function(){this._containerOffset=this.options.isOverflowScroll?0:this._getOffset()},e.detachEvent=function(){N(this._view,"scroll",this._onCheck),N(u,"resize",this._onResize)},e.destroy=function(){this.detachEvent(),this.reset()},e._getOffset=function(){var t=this.options,e=t.container,i=t.horizontal;return e.getBoundingClientRect()[i?"left":"top"]+this.getOrgScrollPos()},t}(),ft=function(l){function t(t,e){var i=l.call(this)||this;i._loadingBar={},i._requestGroups=[],$(i.options=p({},S),e),O&&(i.options.useFit=!1),v&&(i.options.isOverflowScroll=!1),i._reset();var n=i.options,r=n.isOverflowScroll,s=n.isEqualSize,o=n.isConstantSize,a=n.horizontal,u=n.threshold,h=n.useRecycle,c=n.attributePrefix;return i._itemManager=new rt,i._renderer=new at(t,{isEqualSize:s,isConstantSize:o,horizontal:a,container:r}),i._watcher=new lt(i._renderer.view,{isOverflowScroll:r,horizontal:a,container:i._renderer.container,resize:function(){return i._onResize()},check:function(t){return i._onCheck(t)}}),i._infinite=new ut(i._itemManager,{useRecycle:h,threshold:u,append:function(t){return i._requestAppend(t)},prepend:function(t){return i._requestPrepend(t)},recycle:function(t){return i._recycle([t])}}),i._renderManager=new ct(i._infinite,i._itemManager,i._renderer,{attributePrefix:c,isEqualSize:s,isConstantSize:o,horizontal:a}),i}i(t,l);var e=t.prototype;return e.append=function(t,e){return this._layout&&this._insert({elements:t,isAppend:!0,groupKey:e}),this},e.prepend=function(t,e){return this._layout&&this._insert({elements:t,isAppend:!1,groupKey:e}),this},e.setLayout=function(t,e){void 0===e&&(e={});var i=this.options.horizontal;return"function"==typeof t?this._layout=new t($(e,{horizontal:i})):(t.options.horizontal=i,this._layout=t),this._renderManager.setLayout(this._layout),this._renderer.resize(),this._setSize(this._renderer.getViewportSize()),this},e.getItems=function(t){return void 0===t&&(t=!1),t?this._itemManager.pluck("items"):this._infinite.getVisibleItems()},e.getRenderingItems=function(){var t=this.getItems(),e={};t.forEach(function(t){e[t.itemKey]=!0});var i=rt.pluck(this._requestGroups,"items").filter(function(t){return!e[t.itemKey]&&(e[t.itemKey]=!0)});return t.concat(i)},e.beforeSync=function(t){return this._infinite.sync(t)},e.sync=function(n){var t=this._itemManager,e=this._infinite,i=this.getRenderingItems();if(i.forEach(function(t,e){var i=t.el!==n[e];t.el=n[e],i&&at.renderItem(t,t.rect)}),!this._isProcessing()){var r=i.filter(function(t){return!t.orgSize||!t.orgSize.width});if(r.length)this._postLayout({fromCache:!1,groups:e.getVisibleData(),newItems:r,isAppend:!0,isTrusted:!1});else if(t.size())if(e.getCursor("start")<0){var s=t.getGroup(0);this._postLayout({groups:[s],hasChildren:!1,fromCache:!1,isAppend:!0})}else this._infinite.scroll(this._watcher.getScrollPos());else this._requestAppend({})}},e.layout=function(t){if(void 0===t&&(t=!0),!this._layout)return this;var e=this._renderer,i=this._itemManager,n=this._infinite,r=e.resize(),s=this.getItems(),o=this.options,a=o.isEqualSize,u=o.isConstantSize,h=o.transitionDuration,c=t&&(a||u),l=i.size();if(this._watcher.resize(),t&&r&&this._setSize(e.getViewportSize()),!s.length){var f=R(e.container.children).filter(function(t){return-1===t.className.indexOf(z)}),p=0<f.length;if(l){var g=i.getGroup(0);p&&g.items.forEach(function(t,e){t.el=f[e]}),this._postLayout({groups:[g],hasChildren:p,fromCache:!1,isAppend:!0})}else if(p){var d=f[0].getAttribute("data-groupkey");"string"!=typeof d&&(d=void 0),this._insert({elements:f,isAppend:!0,hasChildren:!0,groupKey:d})}else e.getContainerSize()&&e.setContainerSize(0),this._requestAppend({});return this}var _=n.getCursors(),v=_[0],m=_[1],y=!c&&t&&r?i.sliceGroups(v,m+1):i.getGroups();return this._relayout(t,y,r?s:[]),c?this._fit():t&&r&&i.clearOutlines(v,m),at.renderItems(s,h),t&&this._watcher.setScrollPos(),this._onLayoutComplete({items:s,isAppend:!0,fromCache:!0,isTrusted:!1,useRecycle:!1,isLayout:!0}),this},e.removeByIndex=function(t,e,i){void 0===i&&(i=!0);var n=this._infinite.remove(t,e),r=n.items,s=n.group;return r.forEach(function(t){at.removeElement(t.el)}),r.length?(i&&this.layout(!!s),r):[]},e.remove=function(t,e){void 0===e&&(e=!0);var i=this._itemManager.indexesOfElement(t),n=i.groupIndex,r=i.itemIndex;return this.removeByIndex(n,r,e)},e.getGroupKeys=function(t){return(t?this._itemManager.getGroups():this._infinite.getVisibleData()).map(function(t){return t.groupKey})},e.getStatus=function(t,e){return{_status:$({},this._status),_itemManager:this._itemManager.getStatus(t,e),_renderer:this._renderer.getStatus(),_watcher:this._watcher.getStatus(),_infinite:this._infinite.getStatus(t,e)}},e.setStatus=function(t,e,i){if(void 0===e&&(e=!0),!t)return this;var n=t._status,r=t._renderer,s=t._itemManager,o=t._watcher,a=t._infinite;if(!(n&&r&&s&&o&&a))return this;var u=this.options.renderExternal,h=this._itemManager,c=this._renderer,l=this._watcher,f=this._infinite;l.detachEvent(),$(this._status,n),this._status.processingStatus=0,h.setStatus(s),c.setStatus(r),f.setStatus(a);var p=this.getItems(),g=p.length;u?(p.forEach(function(t,e){t.el=i[e]}),at.renderItems(p)):c.createAndInsert(p,!0);var d=c.isNeededResize();l.setStatus(o,e),l.attachEvent();var _=this.options,v=_.isConstantSize,m=_.isEqualSize;return g?d?(c.resize(),this._setSize(c.getViewportSize()),v?this.layout(!0):(this._itemManager.clearOutlines(),this._postLayout({fromCache:!0,groups:m?h.getGroups():f.getVisibleData(),items:p,newItems:p,isAppend:!0,isTrusted:!1}))):this.layout(!1):this._requestAppend({cache:[]}),this},e.clear=function(){return this._itemManager.clear(),this._renderer.clear(),this._infinite.clear(),this._reset(),this._appendLoadingBar(),this},e.setLoadingBar=function(t){void 0===t&&(t={});var e="object"==typeof t?t:{append:t,prepend:t};this._status.loadingSize=0,this._status.loadingStyle={};var i,n,r,s,o=this._loadingBar,a=!1;for(var u in e){var h=q(e[u]);o[u]!==h&&(o[u]=h,a=!0),s=z,((r=h).classList?r.classList.contains(s):r.className.match(new RegExp("(\\s|^)"+s+"(\\s|$)")))||(n=z,(i=h).classList?i.classList.add(n):i.className+=" "+n)}return a&&this._renderLoading(),this._appendLoadingBar(),this},e.isProcessing=function(){return this._isProcessing()||this.isLoading()},e.isLoading=function(){return 0<this._getLoadingStatus()},e.getLoadingBar=function(t){return void 0===t&&(t=2!==this._getLoadingStatus()),this._loadingBar[t?"append":"prepend"]},e.startLoading=function(t,e){var i=this;if(void 0===e&&(e={display:"block"}),this.isLoading())return this;var n=t?"append":"prepend";if(this._process(t?1:2),!this._loadingBar[n])return this;function r(){i._renderLoading(e),i._status.loadingStyle=e,t?i._setContainerSize(i._getEdgeValue("end")+i._status.loadingSize):i._fit()}return this.options.renderExternal?this.trigger("render",{next:r}):r(),this},e.endLoading=function(t){var e;if(void 0===t&&(t={display:"none"}),!this.isLoading())return this;var i=1===this._getLoadingStatus(),n=i?"append":"prepend",r=this._loadingBar[n],s=this._status,o=s.loadingSize;if(this._process(3,!1),s.loadingSize=0,s.loadingStyle={},r){var a=$(((e={})[this.options.horizontal?"left":"top"]=-o+"px",e),t);for(var u in a)r.style[u]=a[u];i?this._setContainerSize(this._getEdgeValue("end")):this._fitItems(o),this.options.renderExternal&&this.trigger("render",{next:function(){}})}return this.options.useRecycle&&!this.isProcessing()&&this._infinite.recycle(this._watcher.getScrollPos(),i),this},e.getItem=function(t,e){if(void 0===t&&(t=0),"object"!=typeof t){var i=this._itemManager.getGroup(t);return i&&i.items[e||0]}if(t)for(var n=this.getItems(),r=n.length,s=0;s<r;++s)if(n[s].el===t)return n[s]},e.updateItem=function(t,e){var i=this.getItem(t,e);return this._updateItem(i)&&this.layout(!1),this},e.updateItems=function(){var e=this;return this.getItems().forEach(function(t){e._updateItem(t)}),this.layout(!1),this},e.moveTo=function(t,s){var o=this;if(void 0===s&&(s=0),this.isProcessing())return this;var e=this._itemManager.getGroup(t);if(!e)return this;var i=this._infinite,n=e.outlines,a=e.items,r=a[s],u=n.start&&0===n.start.length,h=i.getCursors(),c=h[0],l=h[1],f=c<=t&&t<=l,p=this.options,g=p.useRecycle,d=p.horizontal;if(f||!g||!u){var _=r?r.rect[d?"left":"top"]:Math.max.apply(Math,n.start),v=Math.min.apply(Math,n.start);v<0&&(this._fitItems(v,0),_-=v);var m=c<t;return f||m?this._scrollTo(_):this._postLayout({fromCache:!0,groups:[e],items:a,newItems:[],isAppend:m,isTrusted:!1}).on("renderComplete",function(t){var e=t.start,i=t.end,n=o._itemManager;if(n){var r=a[s].rect[d?"left":"top"];f||n.clearOutlines(e,i),o._scrollTo(r),o._setScrollPos(r)}}),this}m=l<t||t<c-1;return this._postCache({isAppend:m,cache:[e],isTrusted:!1}).on("renderComplete",function(t){var e=t.start,i=t.end,n=o._itemManager;if(n){var r=a[s].rect[d?"left":"top"];n.clearOutlines(e,i),o._scrollTo(r),o._setScrollPos(r)}}),this},e.destroy=function(){this._infinite.clear(),this._watcher.destroy(),this._reset(),this._itemManager.clear(),this._renderer.destroy()},e._relayout=function(t,e,i){var n=this._renderer,r=n.options,s=r.isEqualSize,o=r.isConstantSize,a=e.filter(function(t){var e=t.items[0];return e.orgSize&&-1e4<e.rect.top});if(!a.length)return[];var u=a[0].outlines.start;t&&(u=[u.length?Math.min.apply(Math,u):0],!o&&i.length&&(n.updateSize(i),s&&i[0].size&&rt.pluck(a,"items").forEach(function(t){t.size=$({},i[0].size)}))),this._layout.layout(a,u)},e._setContainerSize=function(t){this._renderer.setContainerSize(Math.max(this._itemManager.getMaxEdgeValue(),t))},e._appendLoadingBar=function(){if(!this.options.renderExternal){var t=this._loadingBar,e=this._renderer.container;for(var i in t)e.appendChild(t[i])}},e._setSize=function(t){this._infinite.setSize(this._renderer.getViewSize()),this._layout.setSize(t)},e._fitItems=function(t,e){void 0===e&&(e=0),0<t&&this._watcher.scrollBy(-t),this._itemManager.fit(t,this.options.horizontal),at.renderItems(this.getItems()),this._setContainerSize(this._getEdgeValue("end")||e),t<0&&this._watcher.scrollBy(-t)},e._fit=function(t){void 0===t&&(t=this.options.useFit);var e=this._getEdgeValue("start"),i=2===this._getLoadingStatus()&&this._status.loadingSize||0,n=this.options,r=n.isConstantSize,s=n.isEqualSize;if(!n.useRecycle||!t||r||s)e<i&&this._fitItems(e-i,i),e=0;else{if(0===e&&!i)return 0;this._fitItems(e-i,i)}return this.isLoading()&&this._renderLoading(),e},e._getEdgeValue=function(t){return this._infinite.getEdgeValue(t)},e._isProcessing=function(){return 0<(4&this._status.processingStatus)},e._getLoadingStatus=function(){return 3&this._status.processingStatus},e._process=function(t,e){void 0===e&&(e=!0),e?this._status.processingStatus|=t:this._status.processingStatus-=this._status.processingStatus&t},e._insert=function(t){var e=t.elements,i=t.isAppend,n=t.hasChildren,r=t.groupKey,s=void 0===r?(new Date).getTime()+Math.floor(1e3*Math.random()):r;if(!this._isProcessing()&&0!==e.length){var o=rt.toItems(q(e,!0),s);this._insertItems({items:o,isAppend:i,hasChildren:n,groupKey:s})}},e._insertItems=function(t){var e=t.items,i=t.isAppend,n=t.hasChildren,r=t.groupKey,s=void 0===r?(new Date).getTime()+Math.floor(1e3*Math.random()):r;if(e.length){var o=this._itemManager[i?"appendGroup":"prependGroup"]({groupKey:s,items:e});if(!i){var a=this._infinite,u=a.getCursors(),h=u[0],c=u[1];a.setCursor("start",h+1),a.setCursor("end",c+1)}this._postLayout({fromCache:!1,groups:[o],items:o.items,newItems:o.items,isAppend:i,hasChildren:n,isTrusted:!1})}},e._recycle=function(t){var r=this,e=this.options,i=e.useRecycle,s=e.renderExternal;if(!i)return!1;var o=!1;return t.forEach(function(t){var e=t.start,i=t.end;if(!(-1===e||-1===i||i<e)){var n=r._itemManager.pluck("items",e,i);o=o||n.some(function(t){return t.mounted}),n.forEach(function(t){t.mounted=!1}),s||at.removeItems(n)}}),o&&(this._requestGroups=[],this.trigger("render",{next:function(){}})),o},e._renderLoading=function(t){if(void 0===t&&(t=this._status.loadingStyle),this.isLoading()){var e=1===this._getLoadingStatus(),i=this._loadingBar[e?"append":"prepend"];if(i){var n=$({position:"absolute"},t);for(var r in n)i.style[r]=n[r];this._status.loadingSize=this.options.horizontal?W(i):X(i);var s=this.options.horizontal?"left":"top";if(!(s in n)){var o=e?this._getEdgeValue("end"):this._getEdgeValue("start")-this._status.loadingSize;i.style[s]=o+"px"}}}},e._updateItem=function(t){return!(!t||!t.el)&&(t.content=t.el.outerHTML,this.options.isEqualSize||function(t){t.orgSize=null,t.size=null}(t),this._renderer.updateSize([t]),!0)},e._setScrollPos=function(t){this._watcher.setScrollPos(this._watcher.getContainerOffset()+t)},e._scrollTo=function(t){this._watcher.scrollTo(this._watcher.getContainerOffset()+t)},e._postCache=function(t){var e=t.cache,i=t.isAppend,n=t.isTrusted,r=void 0===n||n,s=this.options.isConstantSize,o=rt.pluck(e,"items"),a=!0,u=o.filter(function(t){return t.orgSize&&t.orgSize.width?!s&&t.rect.top<-1e4:!(a=!1)});return this._postLayout({fromCache:a,groups:e,items:o,newItems:u,isAppend:i,isTrusted:r})},e._postLayout=function(t){var r=this,i=t.fromCache,e=t.groups,n=t.items,s=void 0===n?rt.pluck(e,"items"):n,o=t.newItems,a=t.isAppend,u=t.hasChildren,h=t.isTrusted;if(this._process(4),e.length){var c=this.options.renderExternal,l=this._renderer,f=new g,p=function(){s.forEach(function(t){t.mounted=!0}),r._renderManager.render(f,e,o,a).on("renderComplete",function(t){var e=t.start,i=t.end;r._setCursor(e,i)}).on("imageError",function(t){r.trigger("imageError",$(t,{element:t.item.el}))}).on("layoutComplete",function(t){var e=t.items;r._process(4,!1),r._onLayoutComplete({items:e,isAppend:a,fromCache:i,isTrusted:h,useRecycle:!1})}).on("finish",function(t){var e=t.remove,i=t.layout;if(e.forEach(function(t){return r.remove(t,!1)}),i)r.layout(!1);else if(!r.isProcessing()&&r.options.useRecycle){var n=r._watcher.getScrollPos();r._infinite.recycle(n,a)}})};if(!u){if(c)return s.every(function(t){return t.mounted})?p():(this._requestGroups=e,this.trigger("render",{next:function(){u||at.renderItems(s),p()}})),f;l.createAndInsert(s,a)}return p(),f}},e._requestAppend=function(t){var e=this,i=t.cache;this._isProcessing()||(i&&i.length?this._postCache({cache:i,isAppend:!0}):this.trigger("append",{isTrusted:!0,groupKey:this.getGroupKeys().pop()||"",startLoading:function(t){e.startLoading(!0,t)},endLoading:function(t){e.endLoading(t)}}))},e._requestPrepend=function(t){var e=this,i=t.cache;this._fit(this.options.useFit||!i||!i.length),this._isProcessing()||(i&&i.length?this._postCache({cache:i,isAppend:!1}):this.trigger("prepend",{isTrusted:!0,groupKey:this.getGroupKeys().shift(),startLoading:function(t){e.startLoading(!1,t)},endLoading:function(t){e.endLoading(t)}}))},e._onResize=function(){this.layout(!0)},e._setCursor=function(t,e){var i=this._infinite,n=i.getCursors(),r=n[0],s=n[1];i.setCursor("start",t),i.setCursor("end",e),this._recycle([{start:r,end:t-1},{start:e+1,end:s}])||(this._requestGroups=[],this.trigger("render",{next:function(){}}))},e._onCheck=function(t){var e=t.isForward,i=t.scrollPos,n=t.horizontal,r=t.orgScrollPos;this.trigger("change",{isForward:e,horizontal:n,scrollPos:i,orgScrollPos:r}),this._infinite.scroll(i)},e._onLayoutComplete=function(t){var e=this,i=t.items,n=t.isAppend,r=t.isTrusted,s=void 0!==r&&r,o=t.useRecycle,a=void 0===o?this.options.useRecycle:o,u=t.fromCache,h=void 0!==u&&u,c=t.isLayout,l=void 0!==c&&c,f=this._renderer.getViewSize();n?this.isLoading()&&this._renderLoading():this._fit();var p=this._watcher,g=p.getScrollPos();l||!a||this.isLoading()||this._infinite.recycle(g,n);var d=this._getEdgeValue("end");n&&(this._setContainerSize(d+this._status.loadingSize||0),"number"==typeof g&&0<g&&(_||this._scrollTo(g))),this.trigger("layoutComplete",{target:i.concat(),isAppend:!!n,isTrusted:s,fromCache:h,isLayout:l,isScroll:f<p.getContainerOffset()+d,scrollPos:g,orgScrollPos:p.getOrgScrollPos(),size:d,endLoading:function(t){e.endLoading(t)}}),this._infinite.scroll(g)},e._reset=function(){this._status={processingStatus:0,loadingSize:0,loadingStyle:{}}},t.VERSION="3.6.3",t}(g),pt=C,gt=E,dt=I,_t=x,vt=function(){function t(t){void 0===t&&(t={}),this.options=J({margin:0,horizontal:!1,align:pt,itemSize:0},t),this._size=0,this._columnSize=0,this._columnLength=0,this._style=Q(this.options.horizontal)}var e=t.prototype;return e.append=function(t,e,i){return this._insert(t,e,!0,i)},e.prepend=function(t,e,i){return this._insert(t,e,!1,i)},e.layout=function(t,e){var n=this;void 0===t&&(t=[]),void 0===e&&(e=[]);var r,i=t.length&&t[0].items.length&&t[0].items[0];if(this.checkColumn(i),e.length!==this._columnLength){var s=0===e.length?0:Math.min.apply(Math,e);r=et(new Array(this._columnLength),s)}else r=e.slice();return t.forEach(function(t){var e=t.items,i=n._layout(e,r,!0);t.outlines=i,r=i.end}),this},e.setSize=function(t){return this._size=t,this},e.checkColumn=function(t){var e=this.options,i=e.itemSize,n=e.margin,r=e.horizontal?"height":"width",s=Math.floor(i||t&&t.size[r]||0)||0;(this._columnSize=s)?this._columnLength=Math.max(Math.floor((this._size+n)/(s+n)),1):this._columnLength=1},e._layout=function(t,e,i){for(var n,r=t.length,s=this.options.margin,o=this.options.align,a=this._style,u=a.size1,h=a.size2,c=a.startPos1,l=a.startPos2,f=this._columnSize,p=this._columnLength,g=this._size,d=g-(f+s)*p+s,_=i?"min":"max",v=i?"indexOf":"lastIndexOf",m=e.slice(),y=e.slice(),z=0;z<r;++z){var S=Math[_].apply(Math,y)||0,w=y[v](S),M=t[i?z:r-1-z],C=M.size;if(C){var E=C[u],I=C[h],x=i?S:S-s-E,L=x+E+s;-1===w&&(w=0);var P=(f+s)*w;o===gt?P+=d/2:o===dt?P+=d+f-I:o===_t&&(p<=1?P+=d/2:P=(g-f)/(p-1)*w),M.rect=((n={})[c]=x,n[l]=P,n),y[M.column=w]=i?L:x}}return i||t.sort(function(t,e){var i=t.rect[c],n=t.rect[l],r=e.rect[c],s=e.rect[l];return i-r?i-r:n-s}),{start:i?m:y,end:i?y:m}},e._insert=function(t,e,i,n){void 0===t&&(t=[]),void 0===e&&(e=[]);var r=n?t:Z(t),s=e;return this._columnLength||this.checkColumn(t[0]),e.length!==this._columnLength&&(s=et(new Array(this._columnLength),e.length&&Math[i?"min":"max"].apply(Math,e)||0)),{items:r,outlines:this._layout(r,s,i)}},t}();function mt(t,e,i,n,r,s){for(var o={left:n,top:i,type:e,width:1,height:1},a=n;a<r&&t[i][a]===e;++a)o.width=a-n+1;for(a=i;a<s&&t[a][n]===e;++a)o.height=a-i+1;return function(t,e,i,n,r,s){for(var o=i;o<i+s;++o)for(var a=n;a<n+r;++a)e===t[o][a]&&(t[o][a]=0)}(t,e,i,n,o.width,o.height),o}var yt=function(){function t(t){void 0===t&&(t={}),this.options=J({margin:0,horizontal:!1,itemSize:0,frame:[],frameFill:!0},t);var e=this.options.frame.map(function(t){return t.slice()});this._itemSize=this.options.itemSize||0,this._shapes=function(t){for(var e=t.length,i=e?t[0].length:0,n=[],r=0;r<e;++r)for(var s=0;s<i;++s){var o=t[r][s];o&&n.push(mt(t,o,r,s,i,e))}return n.sort(function(t,e){return t.type<e.type?-1:1}),{shapes:n,width:i,height:e}}(e),this._size=0,this._style=Q(this.options.horizontal)}var e=t.prototype;return e.layout=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=[]);for(var i=t.length,n=e,r=0;r<i;++r){var s=t[r],o=this._layout(s.items,n,!0);n=(s.outlines=o).end}return this},e.setSize=function(t){return this._size=t,this},e.append=function(t,e,i){return this._insert(t,e,!0,i)},e.prepend=function(t,e,i){return this._insert(t,e,!1,i)},e._getItemSize=function(){return this._checkItemSize(),this._itemSize},e._checkItemSize=function(){if(this.options.itemSize)this._itemSize=this.options.itemSize;else{var t=this._style.size2,e=this.options.margin;this._itemSize=(this._size+e)/this._shapes[t]-e}},e._layout=function(t,e,i){var n;void 0===e&&(e=[]);var r=t.length,s=this._style,o=this.options,a=o.margin,u=o.frameFill,h=s.size1,c=s.size2,l=s.startPos1,f=s.startPos2,p=this._getItemSize(),g="object"==typeof p,d=g?p[c]:p,_=g?p[h]:p,v=this._shapes[c],m=this._shapes.shapes,y=m.length,z=et(new Array(v),B),S=et(new Array(v),B),w=0,M=0;if(!y)return{start:e,end:e};for(var C=0;C<r;C+=y){for(var E=0;E<y&&C+E<r;++E){for(var I=t[C+E],x=m[E],L=x[l],P=x[f],O=x[h],T=x[c],A=M-w+L*(_+a),b=P*(d+a),G=O*(_+a)-a,K=T*(d+a)-a,R=P;R<P+T&&R<v;++R)z[R]===B&&(z[R]=A),z[R]=Math.min(z[R],A),S[R]=Math.max(S[R],A+G+a);I.rect=((n={})[l]=A,n[f]=b,n[h]=G,n[c]=K,n)}if(M=Math.max.apply(Math,S),0===C)if(u){w=M;for(E=0;E<v;++E)z[E]!==B&&(w=Math.min(z[E]+M-S[E],w))}else w=0}for(C=0;C<v;++C)z[C]===B&&(z[C]=Math.max.apply(Math,z),S[C]=z[C]);var k=i?z:S,q=0===e.length?0:Math[i?"max":"min"].apply(Math,e),F=i?0:M;if(u&&e.length===v){F=-B;for(C=0;C<v;++C)z[C]!==S[C]&&(F=Math.min(k[C]+q-e[C],F))}for(C=0;C<v;++C)z[C]+=q-F,S[C]+=q-F;return t.forEach(function(t){t.rect[l]+=q-F}),{start:z.map(function(t){return parseInt(t,10)}),end:S.map(function(t){return parseInt(t,10)})}},e._insert=function(t,e,i,n){void 0===t&&(t=[]),void 0===e&&(e=[]);var r=n?t:Z(t);return{items:r,outlines:this._layout(r,e,i)}},t}();function zt(t){if(t.column)return t.column;var e=1;return t.el&&(e=parseInt(t.el.getAttribute("data-column"),10)||1),t.column=e}var St=function(E){function t(t){return void 0===t&&(t={}),E.call(this,t)||this}i(t,E);var e=t.prototype;return e._layout=function(t,e,i){var n,r;void 0===e&&(e=[]),void 0===i&&(i=!1);for(var s=this._getSquareSize(t[0]),o=this.options.margin,a=this.options.column||Math.floor((this._size+o)/(s+o))||1,u=t.length,h=function(t,e,i,n){var r=Math[n?"min":"max"].apply(Math,t)||0;return t.length!==i?et(new Array(i),0):t.map(function(t){return Math.floor((t-r)/e)})}(e,Math.floor(s),a,i),c=i?"min":"max",l=[],f=i?1:-1,p=this._style,g=p.startPos1,d=p.startPos2,_=0;_<u;++_){var v=Math[c].apply(Math,h),m=h[i?"indexOf":"lastIndexOf"](v),y=t[_],z=y.columnWidth,S=z&&z[0]===a&&z[1]||zt(y),w=1;if(1<S){for(var M=1;M<S&&(i&&m+M<a||!i&&0<=m-M)&&(i&&h[m+f*M]<=v||!i&&h[m+f*M]>=v);++M)++w;i||(m-=w-1)}y.columnWidth=[a,w],l.push(((n={width:w,height:w})[g]=v-(i?0:w),n[d]=m,n.type=_+1,n.index=_,n));for(M=0;M<w;++M)h[m+M]=v+f*w}this._shapes=((r={shapes:l})[p.size2]=a,r);var C=E.prototype._layout.call(this,t,e,i);return i||(l.sort(function(t,e){var i=t[g],n=t[d],r=e[g],s=e[d];return i-r?i-r:n-s}),t.sort(function(t,e){var i=t.rect[g],n=t.rect[d],r=e.rect[g],s=e.rect[d];return i-r?i-r:n-s})),C},e._getSquareSize=function(t){var e=this.options,i=e.column,n=e.margin,r=e.itemSize;if(i)this._itemSize=(this._size+n)/i-n;else if(r)this._itemSize=this.options.itemSize;else{var s=this._style.size2,o=this._shapes[s]||Math.floor((this._size+n)/(t.size[s]+n)/zt(t));this._itemSize=(this._size+n)/o-n}return this._itemSize},t}(yt),wt=function(){function t(t){$(this,{originWidth:0,originHeight:0,width:0,height:0,left:0,top:0,items:[]},t)}var e=t.prototype;return e.scaleTo=function(t,e){var i=this.width?t/this.width:0,n=this.height?e/this.height:0;this.items.forEach(function(t){0!=i&&(t.left*=i,t.width*=i),0!=n&&(t.top*=n,t.height*=n)}),this.width=t,this.height=e},e.push=function(t){this.items.push(t)},e.getOriginSize=function(){return this.originWidth*this.originHeight},e.getSize=function(){return this.width*this.height},e.getOriginRatio=function(){return 0===this.originHeight?0:this.originWidth/this.originHeight},e.getRatio=function(){return 0===this.height?0:this.width/this.height},t}();function Mt(t,e){var i=t/e;return i<1&&(i=1/i),i-1}var Ct=function(){function t(t){void 0===t&&(t={}),this.options=J({margin:0,horizontal:!1,aspectRatio:1,sizeWeight:1,ratioWeight:1},t),this._size=0,this._style=Q(this.options.horizontal)}var e=t.prototype;return e.append=function(t,e,i){return this._insert(t,e,!0,i)},e.prepend=function(t,e,i){return this._insert(t,e,!1,i)},e.layout=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=[]);for(var i=t.length,n=e,r=0;r<i;++r){var s=t[r],o=this._layout(s.items,n,!0);n=(s.outlines=o).end}return this},e.setSize=function(t){return this._size=t,this},e._findBestFitArea=function(t,d){if(0===t.getRatio())return t.originWidth=d.width,t.originHeight=d.height,t.width=d.width,void(t.height=d.height);var _,v=1e7,m=!1,y={width:0,height:0},z={width:0,height:0},e=this.options,S=e.sizeWeight,w=e.ratioWeight;t.items.forEach(function(t){for(var e,i=Mt(t.getOriginSize(),t.getSize())*S,n=Mt(t.getOriginRatio(),t.getRatio())*w,r=t.width,s=t.height,o=0;o<2;++o){var a=void 0,u=void 0,h=void 0,c=void 0;0===o?(h=a=r,c=s-(u=s*(d.height/(t.originHeight+d.height)))):(c=u=s,h=r-(a=r*(d.width/(t.originWidth+d.width))));var l=a*u,f=a/u,p=h*c,g=c/c;e=Mt(d.getSize(),l)*S,e+=Mt(d.getRatio(),f)*w,e+=Mt(t.getOriginSize(),p)*S-i,(e+=Mt(t.getOriginRatio(),g)*w-n)===Math.min(e,v)&&(v=e,_=t,m=0===o,y.width=a,y.height=u,z.width=h,z.height=c)}}),function(t,e,i,n,r){t.height=i.height,t.width=i.width,e.height=n.height,e.width=n.width,r?(t.top=e.top+e.height,t.left=e.left):(t.left=e.left+e.width,t.top=e.top)}(d,_,y,z,m)},e._layout=function(t,e,i){var s=this;void 0===e&&(e=[]);var n=this._style,r=this.options,o=r.horizontal,a=r.aspectRatio,u=r.margin,h=n.startPos1,c=this._size*(o?a:1),l=this._size/(o?1:a),f=o?c:l,p=function(t){return t&&t.length?t:[0]}(e),g=i?Math.max.apply(Math,p):Math.min.apply(Math,p)-f-u,d=g+f+u,_=new wt({});return t.forEach(function(t){var e=t.orgSize,i=e.width,n=e.height,r=new wt({width:i,height:n,originWidth:i,originHeight:n});s._findBestFitArea(_,r),_.push(r),_.scaleTo(c+u,l+u)}),t.forEach(function(t,e){var i=_.items[e],n=i.width,r=i.height,s=i.top,o=i.left;t.rect={top:s,left:o,width:n-u,height:r-u},t.rect[h]+=g}),{start:[g],end:[d]}},e._insert=function(t,e,i,n){void 0===t&&(t=[]),void 0===e&&(e=[]);var r=n?t:Z(t);return{items:r,outlines:this._layout(r,e,i)}},t}();function Et(t,e,i){return function(t,e){for(var i=[],n=e;n;)i.push(n),n=t[n];return i.reverse(),i}(function(t,e,i){var n={},r={};r[e]=0;var s,o,a,u,h,c,l=new It(function(t){return t.cost});for(l.push({value:e,cost:0});l.size();)for(var f in o=(s=l.pop()).value,a=s.cost,u=t(o)||{})h=a+u[f],c=r[f],(void 0===r[f]||h<c)&&(r[f]=h,l.push({value:f,cost:h}),n[f]=o);if(void 0!==r[i])return n;var p=["Could not find a path from ",e," to ",i,"."].join("");throw new Error(p)}(t,e,i),i)}var It=function(){function t(t){this.content=[],this.scoreFunction=t}var e=t.prototype;return e.push=function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},e.pop=function(){var t=this.content[0],e=this.content.pop();return 0<this.content.length&&(this.content[0]=e,this.sinkDown(0)),t},e.size=function(){return this.content.length},e.bubbleUp=function(t){for(var e=t,i=this.content[e];0<e;){var n=Math.floor((e+1)/2)-1,r=this.content[n];if(!(this.scoreFunction(i)<this.scoreFunction(r)))break;this.content[n]=i,this.content[e]=r,e=n}},e.sinkDown=function(t){for(var e,i=this.content.length,n=this.content[t],r=this.scoreFunction(n);;){var s=2*(t+1),o=s-1,a=null;if(o<i){var u=this.content[o];(e=this.scoreFunction(u))<r&&(a=o)}if(s<i){var h=this.content[s];this.scoreFunction(h)<(null==a?r:e)&&(a=s)}if(null===a)break;this.content[t]=this.content[a],this.content[a]=n,t=a}},t}(),xt=function(){function t(t){void 0===t&&(t={}),this.options=J({margin:0,horizontal:!1,minSize:0,maxSize:0,column:[1,8]},t),this._style=Q(this.options.horizontal),this._size=0}var e=t.prototype;return e.setSize=function(t){return this._size=t,this},e.append=function(t,e,i){return this._insert(t,e,!0,i)},e.prepend=function(t,e,i){return this._insert(t,e,!1,i)},e.layout=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=[]);for(var i=t.length,n=e,r=0;r<i;++r){var s=t[r],o=this._layout(s.items,n,!0);n=(s.outlines=o).end}return this},e._layout=function(o,t,e){var a=this,i=this._style,u=i.size1,h=i.size2,c=o.length,n=this.options.column,l="object"==typeof n?n:[n,n],r=Et(function(t){for(var e={},i=+t.replace(/[^0-9]/g,""),n=c+1,r=Math.min(i+l[0],n-1);r<n&&!(r-i>l[1]);++r){var s=a._getCost(o,i,r,u,h);null!==s&&(s<0&&r===n-1&&(s=0),e[""+r]=Math.pow(s,2))}return e},"0",""+c);return this._setStyle(o,r,t,e)},e._getSize=function(t,i,n){var e=this.options.margin,r=t.reduce(function(t,e){return t+e.orgSize[n]/e.orgSize[i]},0);return(this._size-e*(t.length-1))/r},e._getCost=function(t,e,i,n,r){var s=this._getSize(t.slice(e,i),n,r),o=this.options.minSize||0,a=this.options.maxSize||1/0;return isFinite(a)?s<o?Math.pow(s-o,2)+Math.pow(a,2):a<s?Math.pow(s-a,2)+Math.pow(a,2):Math.min(s-a,o-s):s<o?Math.max(Math.pow(o,2),Math.pow(s,2)):s-o},e._setStyle=function(t,e,i,n){var r;void 0===i&&(i=[]);for(var s=this._style,o=s.startPos1,a=s.size1,u=s.startPos2,h=s.size2,c=e.length,l=this.options.margin,f=i[0]||0,p=f,g=0,d=0;d<c-1;++d){for(var _=parseInt(e[d],10),v=parseInt(e[d+1],10),m=t.slice(_,v),y=m.length,z=this._getSize(m,a,h),S=p,w=0;w<y;++w){var M=(x=m[w]).orgSize[h]/x.orgSize[a]*z,C=0===w?0:m[w-1].rect,E=C?C[u]+C[h]+l:0;x.rect=((r={})[o]=S,r[u]=E,r[a]=z,r[h]=M,r)}p=f+(g+=l+z)}var I=t.length;if(n)return{start:[f],end:[p]};for(d=0;d<I;++d){var x;(x=t[d]).rect[o]-=g}return{start:[f-g],end:[f]}},e._insert=function(t,e,i,n){void 0===t&&(t=[]),void 0===e&&(e=[]);var r=n?t:Z(t);return{items:r,outlines:this._layout(r,e,i)}},t}();return ft.categorize=nt,ft.INFINITEGRID_METHODS=K,ft.INFINITEGRID_EVENTS=["append","prepend","imageError","change","layoutComplete"],ft.withInfiniteGridMethods=function(t,s){Object.keys(K).forEach(function(r){t[r]||(t[r]=function(){for(var t,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=(t=this[s])[r].apply(t,e);return n===this[s]?this:n})})},ft.CONTAINER_CLASSNAME=a,ft.IGNORE_CLASSNAME=z,ft.DEFAULT_OPTIONS=S,ft.GridLayout=vt,ft.FrameLayout=yt,ft.SquareLayout=St,ft.PackingLayout=Ct,ft.JustifiedLayout=xt,ft.ItemManager=rt,ft.Infinite=ut,ft.DOMRenderer=at,ft.default=ft});
//# sourceMappingURL=infinitegrid.min.js.map
