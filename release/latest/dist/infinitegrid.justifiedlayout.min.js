/*
Copyright (c) 2015 NAVER Corp.
name: @egjs/infinitegrid
license: MIT
author: NAVER Corp.
repository: https://github.com/naver/egjs-infinitegrid
version: 3.7.0
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t.eg=t.eg||{},t.eg.InfiniteGrid=e())}(this,function(){"use strict";var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var g=function(){return(g=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function c(t){return void 0===t}var v=function(){function t(){this.options={},this._eventHandler={}}var e=t.prototype;return e.trigger=function(t){for(var e=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var r=this._eventHandler[t]||[];if(!(0<r.length))return!0;var o=n[0]||{},s=n.slice(1);r=r.concat();var a=!1;o.eventType=t,o.stop=function(){a=!0},o.currentTarget=this;var u=[o];return 1<=s.length&&(u=u.concat(s)),r.forEach(function(t){t.apply(e,u)}),!a},e.once=function(n,i){var r=this;if("object"==typeof n&&c(i)){var t=n;for(var e in t)this.once(e,t[e]);return this}if("string"==typeof n&&"function"==typeof i){var o=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];i.apply(r,t),r.off(n,o)};this.on(n,o)}return this},e.hasOn=function(t){return!!this._eventHandler[t]},e.on=function(t,e){if("object"==typeof t&&c(e)){var n=t;for(var i in n)this.on(i,n[i]);return this}if("string"==typeof t&&"function"==typeof e){var r=this._eventHandler[t];c(r)&&(this._eventHandler[t]=[],r=this._eventHandler[t]),r.push(e)}return this},e.off=function(t,e){var n,i;if(c(t))return this._eventHandler={},this;if(c(e)){if("string"==typeof t)return delete this._eventHandler[t],this;var r=t;for(var o in r)this.off(o,r[o]);return this}var s=this._eventHandler[t];if(s){var a=0;try{for(var u=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(s),h=u.next();!h.done;h=u.next()){if(h.value===e){s.splice(a,1);break}a++}}catch(t){n={error:t}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}}return this},t.VERSION="2.2.2",t}(),_=function(){function t(){this.keys=[],this.values=[]}var e=t.prototype;return e.get=function(t){return this.values[this.keys.indexOf(t)]},e.set=function(t,e){var n=this.keys,i=this.values,r=n.indexOf(t),o=-1===r?n.length:r;n[o]=t,i[o]=e},t}(),y=function(){function t(){this.object={}}var e=t.prototype;return e.get=function(t){return this.object[t]},e.set=function(t,e){this.object[t]=e},t}(),z="function"==typeof Map,r=function(){function t(){}var e=t.prototype;return e.connect=function(t,e){this.prev=t,this.next=e,t&&(t.next=this),e&&(e.prev=this)},e.disconnect=function(){var t=this.prev,e=this.next;t&&(t.next=e),e&&(e.prev=t)},e.getIndex=function(){for(var t=this,e=-1;t;)t=t.prev,++e;return e},t}();var u,S=function(){function t(t,e,n,i,r,o,s,a){this.prevList=t,this.list=e,this.added=n,this.removed=i,this.changed=r,this.maintained=o,this.changedBeforeAdded=s,this.fixed=a}var e=t.prototype;return Object.defineProperty(e,"ordered",{get:function(){return this.cacheOrdered||this.caculateOrdered(),this.cacheOrdered},enumerable:!0,configurable:!0}),Object.defineProperty(e,"pureChanged",{get:function(){return this.cachePureChanged||this.caculateOrdered(),this.cachePureChanged},enumerable:!0,configurable:!0}),e.caculateOrdered=function(){var t=function(t,n){var a=[],u=[];return t.forEach(function(t){var e=t[0],n=t[1],i=new r;a[e]=i,u[n]=i}),a.forEach(function(t,e){t.connect(a[e-1])}),t.filter(function(t,e){return!n[e]}).map(function(t,e){var n=t[0],i=t[1];if(n===i)return[0,0];var r=a[n],o=u[i-1],s=r.getIndex();return r.disconnect(),o?r.connect(o,o.next):r.connect(void 0,a[0]),[s,r.getIndex()]})}(this.changedBeforeAdded,this.fixed),a=this.changed,u=[];this.cacheOrdered=t.filter(function(t,e){var n=t[0],i=t[1],r=a[e],o=r[0],s=r[1];if(n!==i)return u.push([o,s]),!0}),this.cachePureChanged=u},t}();function p(t,e,n){var i=z?Map:n?y:_,r=n||function(t){return t},o=[],s=[],a=[],u=t.map(r),h=e.map(r),c=new i,l=new i,f=[],d=[],p={},g=[],v=0,m=0;return u.forEach(function(t,e){c.set(t,e)}),h.forEach(function(t,e){l.set(t,e)}),u.forEach(function(t,e){var n=l.get(t);void 0===n?(++m,s.push(e)):p[n]=m}),h.forEach(function(t,e){var n=c.get(t);void 0===n?(o.push(e),++v):(a.push([n,e]),m=p[e]||0,f.push([n-m,e-v]),d.push(e===n),n!==e&&g.push([n,e]))}),s.reverse(),new S(t,e,o,s,g,a,f,d)}var t,h=(u="undefined"==typeof window?{document:{},navigator:{userAgent:""}}:window).document,e=u.navigator.userAgent,n=!!("getComputedStyle"in u),o=!!("addEventListener"in h),s=function(){var t=!1;try{o&&Object.defineProperty&&h.addEventListener("test",function(){},Object.defineProperty({},"passive",{get:function(){t=!0}}))}catch(t){}return t}(),m=(/MSIE|Trident|Windows Phone|Edge/.test(e),/iPhone|iPad/.test(e)),C=/Android 2\./.test(e),l="_eg-infinitegrid-container_",E="_eg-infinitegrid-ignore_",a="_INFINITEGRID_TRANSITION",f="vertical",d="horizontal",w=-1e5,x="data-groupkey",P={itemSelector:"*",isOverflowScroll:!1,threshold:100,isEqualSize:!1,isConstantSize:!1,useRecycle:!0,horizontal:!1,transitionDuration:0,useFit:!0,attributePrefix:"data-",renderExternal:!1,resizeDebounce:100,maxResizeDebounce:0,percentage:!1},R={horizontal:!1,margin:0},M=e.toLowerCase(),I=(/mobi|ios|android/.test(M),/applewebkit\/([\d|.]*)/g.exec(M)),L=I&&parseInt(I[1],10)||0,b=L&&L<537,O=["content","groupKey","itemKey","orgSize","mounted","prevRect","rect","size"],T=(t=function(){var t={transitionend:"",webkitTransitionEnd:"-webkit-",MSTransitionEnd:"-ms-",oTransitionEnd:"-o-",mozTransitionEnd:"-moz-"};for(var e in t){var n=t[e];if("on"+e.toLowerCase()in u)return[n+"transform",n+"transition",e]}return[]}())[0],k=t[1],A=t[2];function G(t){var e=[];if(t)for(var n=t.length,i=0;i<n;i++)e.push(t[i]);return e}function K(t){return t.match(/^<([A-z]+)\s*([^>]*)>/)}function j(t,e){var n;if(void 0===e&&(e=!1),"string"!=typeof t)return Q(t)?n=t:!function(t){return"function"==typeof u.jQuery&&t instanceof u.jQuery||t.constructor.prototype.jquery&&t.toArray}(t)?Array.isArray(t)?(n=t.map(function(t){return j(t)}),e||(n=1<=n.length?n[0]:void 0)):n=!t.nodeName||1!==t.nodeType&&9!==t.nodeType?[].slice.call(n):t:n=e?j(t.toArray(),!0):j(t.get(0),!1),n;if(K(t)){var i=h.createElement("div");i.innerHTML=t,n=i.childNodes}else n=h.querySelectorAll(t);return e?G(n):n&&n[0]}function D(t,e,n,i){if(o){var r=i||!1;"object"==typeof i&&(r=!!s&&i),t.addEventListener(e,n,r)}else t.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n}function q(t,e,n){t.removeEventListener?t.removeEventListener(e,n,!1):t.detachEvent?t.detachEvent("on"+e,n):t["on"+e]=null}function V(t){return(n?u.getComputedStyle(t):t.currentStyle)||{}}function B(t,e,n){if(Q(t))return u["inner"+e]||h.body["client"+e];if(function(t){return 9===t.nodeType}(t)){var i=t.documentElement,r=t.body;return Math.max(r["scroll"+e],i["scroll"+e],r["offset"+e],i["offset"+e],i["client"+e])}var o=0;if(n){var s=t.getBoundingClientRect();o="Width"===e?s.right-s.left:s.bottom-s.top}else o=t["client"+e]||t["offset"+e];if(o)return o;var a=V(t)[e.toLowerCase()];return~a.indexOf("px")&&parseFloat(a)||0}function F(t){return B(t,"Width",!1)}function H(t){return B(t,"Height",!1)}function N(t){return B(t,"Width",!0)}function X(t){return B(t,"Height",!0)}function W(t){return{width:N(t),height:X(t)}}var U={vertical:{startPos1:"top",endPos1:"bottom",size1:"height",startPos2:"left",endPos2:"right",size2:"width"},horizontal:{startPos1:"left",endPos1:"right",size1:"width",startPos2:"top",endPos2:"bottom",size2:"height"}};function Y(n){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return t.forEach(function(t){for(var e in t)n[e]=t[e]}),n}function Q(t){return t===u}function $(t){return void 0===t}var J=function(){function r(){this._groups=[],this._groupKeys={}}var t=r.prototype;return r.toItems=function(t,e){return t.map(function(t){return function(t,e){return{el:e,groupKey:t,mounted:!1,needUpdate:!0,content:e?e.outerHTML:"",rect:{top:w,left:w}}}(e,t)})},r.pluck=function(t,n){return t.reduce(function(t,e){return t.concat(e[n])},[])},t.clear=function(){this._groups=[],this._groupKeys={}},t.getStatus=function(t,e){var n=this._groups,i=Math.max(this.indexOf(t),0),r=this.indexOf(e)+1||n.length;return{_data:n.slice(i,r).map(function(t){var e=t.items.map(function(e){var n={};return O.forEach(function(t){t in e&&(n[t]=e[t])}),n}),n=Y({},t);return n.items=e,n})}},t.setStatus=function(t){var n=this,e=t._data;this.clear(),e.forEach(function(t,e){n.insertGroup(t,e)})},t.size=function(){return this._groups.length},t.fit=function(i,t){var e=this._groups;if(e.length){var r=t?"left":"top";0!==i&&e.forEach(function(t){var e=t.items,n=t.outlines;e.forEach(function(t){t.rect[r]-=i}),n.start=n.start.map(function(t){return t-i}),n.end=n.end.map(function(t){return t-i})})}},t.pluck=function(t,e,n){var i=$(e)?this._groups:this.sliceGroups(e,($(n)?e:n)+1);return r.pluck(i,t)},t.getOutline=function(t,e){var n=this._groups[t];return n?n.outlines[e]:[]},t.getEdgeIndex=function(t,e,n){for(var i="start"===t?"min":"max",r=-1,o="start"===t?1/0:-1/0,s=e;s<=n;s++){var a=Math[i].apply(Math,this.getOutline(s,t));("start"===t&&a<o||"end"===t&&o<a)&&(o=a,r=s)}return r},t.getEdgeValue=function(t,e,n){var i=this.getGroup(this.getEdgeIndex(t,e,n));if(i){var r=i.outlines[t];if(r.length)return Math["start"===t?"min":"max"].apply(Math,r)}return 0},t.clearOutlines=function(n,i){void 0===n&&(n=-1),void 0===i&&(i=-1),this.getGroups().forEach(function(t,e){n<=e&&e<=i||(t.items.forEach(function(t){t.rect.top=w,t.rect.left=w}),t.outlines.start=[],t.outlines.end=[])})},t.getMaxEdgeValue=function(){for(var t=this._groups,e=t.length-1;0<=e;--e){var n=t[e].outlines.end;if(n.length)return Math.max.apply(Math,n)}return 0},t.prependGroup=function(t){return this.insertGroup(t,0)},t.appendGroup=function(t){return this.insertGroup(t,this._groups.length)},t.insertGroup=function(t,n){var i=this;if(n<0)return null;var e=t.items||[],r=g(g({outlines:{start:[],end:[]}},t),{items:[]});return this._groups.splice(n,0,r),this._groupKeys[r.groupKey]=r,e.forEach(function(t,e){i.insert(t,n,e)}),r},t.sync=function(t){var n=this,i=this._groups,r=this._groupKeys,o=function(t){var i=[],r={};return t.forEach(function(t){var e=t.groupKey,n=r[e];n||(n={groupKey:e,items:[]},r[e]=n,i.push(n)),n.items.push(t)}),i}(t),e=p(i,o,function(t){return t.groupKey}),s=e.removed,a=e.added,u=e.maintained;s.forEach(function(t){var e=i[t];e&&delete r[e.groupKey]});var h=[];return u.forEach(function(t){var e=t[0];h.push(i[e])}),this._groups=h,a.forEach(function(t){n.insertGroup(o[t],t)}),u.reverse().forEach(function(t){var e=t[1];n.syncItems(e,o[e].items)}),e},t.insert=function(t,e,n){void 0===e&&(e=-1),void 0===n&&(n=-1);var i=t.groupKey,r=this._groups,o=this._groupKeys,s=(-1<e?r[e]:o[i])||this.insertGroup({groupKey:i},e);if(!s)return null;var a=g({content:"",mounted:!1,needUpdate:!0,rect:{top:w,left:w}},t),u=s.items;return-1===n?u.push(a):u.splice(n,0,a),a},t.removeGroup=function(t){var e=this._groups.splice(t,1)[0];return e?(delete this._groupKeys[e.groupKey],e):null},t.remove=function(t,e){var n=this.getGroup(t),i=null,r=[];return n&&(r=n.items.splice(e,1),n.items.length||(i=this.removeGroup(t))),{items:r,group:i}},t.indexOf=function(t){if(void 0===t)return-1;for(var e=""+("object"==typeof t?t.groupKey:t),n=this._groups,i=n.length,r=0;r<i;++r)if(e==""+n[r].groupKey)return r;return-1},t.indexesOfElement=function(t){var e=t.getAttribute(x),n=this.indexOf({groupKey:e}),i=-1;if(-1<n)for(var r=this.getGroup(n),o=r.items.length,s=0;s<o;s++)if(r.items[s].el===t){i=s;break}return{groupIndex:n,itemIndex:i}},t.sliceGroups=function(t,e){return this._groups.slice(t,e)},t.getGroups=function(){return this._groups},t.getGroupByKey=function(t){return this._groupKeys[t]},t.getGroup=function(t){return this._groups[t]},t.syncItems=function(e,r){var n=this;if(r.length){var o=this.getGroup(e).items,t=p(o,r,function(t){return t.itemKey}),i=t.added,s=t.maintained,a=this._groups[e],u=[];s.forEach(function(t){var e=t[0],n=t[1],i=o[e];Y(i,r[n]),u.push(i)}),a.items=u,i.forEach(function(t){n.insert(r[t],e,t)})}else this.removeGroup(e)},r}();function Z(t){t[k+"-property"]="",t[k+"-duration"]="",t[T]=""}var tt=function(){function n(t,e){this.options={isEqualSize:!1,isConstantSize:!1,horizontal:!1,container:!1,percentage:!1},this._size={container:-1,view:-1,viewport:-1,item:null},this._orgStyle={},this._isSizePercentage=!1,this._isPosPercentage=!1,Y(this.options,e),this._init(t),this.resize()}var t=n.prototype;return n.removeItems=function(t){t.forEach(function(t){t.el&&(n.removeElement(t.el),t.el=null)})},n.removeElement=function(t){var e=t&&t.parentNode;e&&e.removeChild(t)},n.createElements=function(t){if(t.length){var e=t.filter(function(t){return!t.el});if(e.length){var n=j(e.map(function(t){return t.content.replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g,"")}).join(""),!0);e.forEach(function(t,e){t.el=n[e]})}}},t.getStatus=function(){return{cssText:this.container.style.cssText,_size:Y({},this._size)}},t.setStatus=function(t){this.container.style.cssText=t.cssText,Y(this._size,t._size)},t.updateSize=function(t){var e=this.options,n=e.isEqualSize,i=e.isConstantSize,r=this._size;return t.map(function(t){return t.el&&(n&&!r.item&&(r.item=W(t.el)),t.size=n&&Y({},r.item)||i&&t.orgSize&&t.orgSize.width&&Y({},t.orgSize)||W(t.el),t.orgSize&&t.orgSize.width&&t.orgSize.height||(t.orgSize=Y({},t.size))),t})},t.createAndInsert=function(t,e){n.createElements(t),this.renderItems(t),this._insert(t,e)},t.renderItems=function(t,e){var n=this;t.forEach(function(t){n.renderItem(t,t.rect,e)})},t.renderItem=function(e,t,n){var i=this;if(e.el){var r=e.el,o=e.prevRect,s=r.style;if(r.setAttribute(x,""+e.groupKey),s.position="absolute",this._render(["width","height"],t,s),n&&k&&o){if(function(t,e,n,i){e?n.left===i.left&&n.top===i.top||(t[k+"-property"]=T+",width,height",t[k+"-duration"]=e+"s",t[T]="translate("+(n.left-i.left)+"px,"+(n.top-i.top)+"px)"):Z(t)}(s,n,t,o),r[a])return;r[a]=!0,function(e,n,i,t){var r=function(t){q(e,n,r),i(t)};D(e,n,r,t)}(r,A,function(){var t=e.rect;Z(s),i._render(["left","top"],t,s),e.prevRect=t,r[a]=!1})}else this._render(["left","top"],t,s),e.prevRect=t}},t.getViewSize=function(){return this._size.view},t.getViewportSize=function(){return this._size.viewport},t.getContainerSize=function(){return this._size.container},t.setContainerSize=function(t){this._size.container=t,this.container.style[this.options.horizontal?"width":"height"]=t+"px"},t.resize=function(){var t=this.options.horizontal,e=this.view,n=this._calcSize();if(0!==n){var i=n!==this._size.viewport;return i&&(this._size={view:-1,container:-1,viewport:n,item:null}),this._size.view=t?F(e):H(e),i}},t.isNeededResize=function(){return this._calcSize()!==this._size.viewport},t.clear=function(){this.container.innerHTML="",this.container.style[this.options.horizontal?"width":"height"]="",this._size={item:null,viewport:-1,container:-1,view:-1}},t.destroy=function(){this.clear();var t,e=this.options.container;for(t in this._orgStyle)this[e?"view":"container"].style[t]=this._orgStyle[t];e&&this.container.parentNode.removeChild(this.container)},t._init=function(t){var e=j(t),n=V(e),i=this.options,r=i.container,o=i.horizontal,s=i.percentage;if(s&&(this._isSizePercentage=!0===s||-1<s.indexOf("size"),this._isPosPercentage=!0===s||-1<s.indexOf("position")),"static"===n.position&&(this._orgStyle.position=e.style.position,e.style.position="relative"),r){var a=o?["X","Y"]:["Y","X"];this._orgStyle.overflowX=e.style.overflowX,this._orgStyle.overflowY=e.style.overflowY,e.style["overflow"+a[0]]="scroll",e.style["overflow"+a[1]]="hidden",this.view=e,this.container=!0===r?function(t){var e=t.querySelector("."+l);if(e)return e.style.position="relative",e.style.height="100%",e;var n=h.createElement("div");n.className=l,n.style.position="relative",n.style.height="100%";for(var i=t.children,r=i.length,o=0;o<r;o++)n.appendChild(i[0]);return t.appendChild(n),n}(this.view):r}else this.view=u,this.container=e},t._insert=function(t,e,n){var i=this,r=this.container,o=h.createDocumentFragment();t.forEach(function(t){n&&i.renderItem(t,n),e?o.appendChild(t.el):o.insertBefore(t.el,o.firstChild)}),e?r.appendChild(o):r.insertBefore(o,r.firstChild)},t._calcSize=function(){return this.options.horizontal?H(this.container):F(this.container)},t._render=function(t,i,r){var o=this._isSizePercentage,s=this._isPosPercentage,a=this.getViewportSize(),u=this.options.horizontal;t.forEach(function(t){if(t in i){var e=u&&(o&&"height"===t||s&&"top"===t),n=!u&&(o&&"width"===t||s&&"left"===t);r[t]=e||n?i[t]/a*100+"%":i[t]+"px"}})},n}();var et=function(){function t(t,e){this.options=Y({useRecycle:!0,threshold:100,append:function(){},prepend:function(){},recycle:function(){}},e),this._itemManager=t,this.clear()}var e=t.prototype;return e.setSize=function(t){this._status.size=t},e.sync=function(t){var e=this._status,n=e.startCursor,i=e.endCursor,r=this._itemManager,o=r.sliceGroups(n,i+1),s=J.pluck(o,"items"),a=r.sync(t),u=function(t,e){for(var n=t.length,i=0;i<n;++i)if(e(t[i]))return t[i];return null}(o,function(t){var e=t.groupKey;return r.getGroupByKey(e)}),h=function(t,e){for(var n=t.length-1;0<=n;--n)if(e(t[n]))return t[n];return null}(o,function(t){var e=t.groupKey;return r.getGroupByKey(e)}),c=u?r.indexOf(u):-1,l=h?r.indexOf(h):-1;if(-1<c&&-1<l){var f=Math.min(c,l),d=Math.max(c,l);c=f,l=d}else-1<l?c=l:-1<c&&(l=c);return e.startCursor=c,e.endCursor=l,0<a.removed.length?"relayout":0<p(s,r.pluck("items",n,i),function(t){return t.itemKey}).removed.length?"layout":""},e.recycle=function(e,t){if(this.options.useRecycle&&"number"==typeof e){var n=this._status,i=n.startCursor,r=n.endCursor,o=n.size;if(-1!==i&&-1!==r){var s=e+o,a=this.options,u=a.threshold,h=a.recycle,c=this._itemManager.sliceGroups(i,r+1).map(function(t){return function(t,e,n,i){var r=t.items,o=t.outlines,s=o.start,a=o.end;if(0===s.length||0===a.length||!r.length||!r[0].el)return 2;var u=Math.min.apply(Math,s),h=Math.max.apply(Math,a);return i+e<u?1:h<n-e?-1:0}(t,u,e,s)}),l=c.length,f=t?0:c.lastIndexOf(0),d=t?c.indexOf(0)-1:c.length-1;t||-1===f||(f+=1),f<0||d<0||d<f||l<=d-f+1||(f=i+f,d=i+d,t?this.setCursor("start",d+1):this.setCursor("end",f-1),h({start:f,end:d}))}}},e.scroll=function(a){var t=this.getCursors(),e=t[0],n=t[1],i=this._itemManager;if("number"==typeof a&&-1!==e&&-1!==n&&i.size()){var r=this._status.size,o=this.options,u=o.threshold,s=o.append,h=o.prepend,c=i.getGroups(),l=a+r,f=Math.max.apply(Math,c[e].outlines.start),d=Math.min.apply(Math,c[n].outlines.end),p=c.map(function(t,e){var n=t.outlines,i=n.start,r=n.end;if(!i.length||!r.length)return!1;var o=Math.min.apply(Math,i),s=Math.max.apply(Math,r);return o-u<=l&&a<=s+u}),g=p.indexOf(!0),v=p.lastIndexOf(!0);if(~g&&g<e)h({cache:c.slice(g,Math.min(e,v+1))});else if(n<v)s({cache:c.slice(Math.max(g,n+1),v+1)});else{var m=c.slice(n+1,n+2),_=c.slice(e-1,e),y=a<=f+u;d-u<=l&&(!y||m.length||!_.length)?s({cache:m}):y&&h({cache:_})}}},e.setCursor=function(t,e){var n=this._status,i=this._itemManager,r=i.size();if(!this.options.useRecycle){if(n.startCursor=0,i.getOutline(r-1,"end").length)return void(n.endCursor=r-1);if("end"!==t)return}"start"===t?n.startCursor=e:n.endCursor=Math.min(r-1,e),n.startCursor=Math.max(0,n.startCursor)},e.setStatus=function(t){this._status=Y(this._status,t)},e.getStatus=function(t,e){var n=this._status,i=n.startCursor,r=n.endCursor,o=n.size,s=Math.max(this._itemManager.indexOf(t),0),a=(this._itemManager.indexOf(e)+1||this._itemManager.size())-1,u=Math.max(i-s,~i?0:-1);return{startCursor:u,endCursor:Math.max(Math.min(r-s,a-s),u),size:o}},e.getEdgeOutline=function(t){var e=this._status,n=e.startCursor,i=e.endCursor;return-1===n||-1===i?[]:this._itemManager.getOutline("start"===t?n:i,t)},e.getEdgeValue=function(t){var e=this.getEdgeOutline(t);return e.length?Math["start"===t?"min":"max"].apply(Math,e):0},e.getVisibleItems=function(){var t=this._status,e=t.startCursor,n=t.endCursor;return this._itemManager.pluck("items",e,n)},e.getCursors=function(){var t=this._status;return[t.startCursor,t.endCursor]},e.getCursor=function(t){return this._status["start"===t?"startCursor":"endCursor"]},e.getVisibleData=function(){var t=this._status,e=t.startCursor,n=t.endCursor;return this._itemManager.sliceGroups(e,n+1)},e.remove=function(t,e){var n=this._status,i=this._itemManager,r=n.startCursor,o=n.endCursor,s=i.remove(t,e);return s.group&&(t<r&&this.setCursor("start",r-1),t<=o&&this.setCursor("end",o-1)),i.size()||(n.startCursor=-1,n.endCursor=-1),s},e.clear=function(){this._status={startCursor:-1,endCursor:-1,size:-1}},t}(),nt=function(t,e){return(nt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function it(t,e){function n(){this.constructor=t}nt(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var rt=function(){return(rt=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};var ot="undefined"!=typeof window,st=ot?window.navigator.userAgent:"",at=ot&&!!("getComputedStyle"in window),ut=/MSIE|Trident|Windows Phone|Edge/.test(st),ht=ot&&!!("addEventListener"in document),ct="width",lt="height";function ft(t,e){return t.getAttribute(e)||""}function dt(t){return[].slice.call(t)}function pt(t){return"loading"in t&&"lazy"===t.getAttribute("loading")}function gt(t,e,n){ht?t.addEventListener(e,n,!1):t.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n}function vt(t,e,n){t.removeEventListener?t.removeEventListener(e,n,!1):t.detachEvent?t.detachEvent("on"+e,n):t["on"+e]=null}function mt(t,e){var n=t["client"+e]||t["offset"+e];return parseFloat(n||function(t){return(at?window.getComputedStyle(t):t.currentStyle)||{}}(t)[e.toLowerCase()])||0}function _t(t,e,n){var i=dt(t.querySelectorAll(function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,r++)i[r]=o[s];return i}(["["+n+"skip] ["+n+"width]"],e.map(function(t){return["["+n+"skip] "+t,t+"["+n+"skip]","["+n+"width] "+t].join(", ")})).join(", ")));return dt(t.querySelectorAll("["+n+"width], "+e.join(", "))).filter(function(t){return-1===i.indexOf(t)})}var yt=[];function zt(t,e){yt.length||gt(window,"resize",Ct),t.__PREFIX__=e,yt.push(t),St(t)}function St(t,e){void 0===e&&(e="data-");var n=t.__PREFIX__||e,i=parseInt(ft(t,""+n+ct),10)||0,r=parseInt(ft(t,""+n+lt),10)||0;if(ft(t,n+"fixed")===lt){var o=function(t){return mt(t,"Height")}(t)||r;t.style[ct]=i/r*o+"px"}else{o=function(t){return mt(t,"Width")}(t)||i;t.style[lt]=r/i*o+"px"}}function Ct(){yt.forEach(function(t){St(t)})}var Et=function(i){function t(t,e){void 0===e&&(e={});var n=i.call(this)||this;return n.isReady=!1,n.isPreReady=!1,n.hasDataSize=!1,n.hasLoading=!1,n.isSkip=!1,n.onCheck=function(t){n.destroy(),t&&"error"===t.type&&n.onError(n.element);var e=!n.hasDataSize&&!n.hasLoading;n.onReady(e)},n.options=rt({prefix:"data-"},e),n.element=t,n.hasDataSize=function(t,e){return void 0===e&&(e="data-"),!!t.getAttribute(e+"width")}(t,n.options.prefix),n.hasLoading=pt(t),n.isSkip=function(t,e){return void 0===e&&(e="data-"),!!t.getAttribute(e+"skip")}(n.element),n}it(t,i);var e=t.prototype;return e.check=function(){return this.isSkip||!this.checkElement()?(this.onAlreadyReady(!0),!1):(this.hasDataSize&&zt(this.element,this.options.prefix),(this.hasDataSize||this.hasLoading)&&this.onAlreadyPreReady(),!0)},e.addEvents=function(){var e=this,n=this.element;this.constructor.EVENTS.forEach(function(t){gt(n,t,e.onCheck)})},e.destroy=function(){var e=this,n=this.element;this.constructor.EVENTS.forEach(function(t){vt(n,t,e.onCheck)}),this.removeAutoSizer()},e.removeAutoSizer=function(){if(this.hasDataSize){var t=this.options.prefix;!function(t,e){var n=yt.indexOf(t);if(!(n<0)){var i=ft(t,e+"fixed");delete t.__PREFIX__,t.style[i===lt?ct:lt]="",yt.splice(n,1),yt.length||vt(window,"resize",Ct)}}(this.element,t)}},e.onError=function(t){this.trigger("error",{element:this.element,target:t})},e.onPreReady=function(){this.isPreReady||(this.isPreReady=!0,this.trigger("preReady",{element:this.element,hasLoading:this.hasLoading,isSkip:this.isSkip}))},e.onReady=function(t){this.isReady||(t&&(this.isPreReady=!0),this.removeAutoSizer(),this.isReady=!0,this.trigger("ready",{element:this.element,withPreReady:t,hasLoading:this.hasLoading,isSkip:this.isSkip}))},e.onAlreadyError=function(t){var e=this;setTimeout(function(){e.onError(t)})},e.onAlreadyPreReady=function(){var t=this;setTimeout(function(){t.onPreReady()})},e.onAlreadyReady=function(t){var e=this;setTimeout(function(){e.onReady(t)})},t.EVENTS=[],t}(v),wt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}it(e,t);var n=e.prototype;return n.setHasLoading=function(t){this.hasLoading=t},n.check=function(){return this.isSkip?(this.onAlreadyReady(!0),!1):(this.hasDataSize?(zt(this.element,this.options.prefix),this.onAlreadyPreReady()):this.trigger("requestChildren"),!0)},n.checkElement=function(){return!0},n.destroy=function(){this.removeAutoSizer(),this.trigger("requestDestroy")},n.onAlreadyPreReady=function(){t.prototype.onAlreadyPreReady.call(this),this.trigger("reqeustReadyChildren")},e.EVENTS=[],e}(Et),xt=function(n){function t(t){void 0===t&&(t={});var e=n.call(this)||this;return e.readyCount=0,e.preReadyCount=0,e.totalCount=0,e.totalErrorCount=0,e.isPreReadyOver=!0,e.elementInfos=[],e.options=rt({loaders:{},prefix:"data-"},t),e}it(t,n);var e=t.prototype;return e.check=function(t){var u=this,n=this.options.prefix;this.clear(),this.elementInfos=dt(t).map(function(t,a){var e=u.getLoader(t,{prefix:n});return e.check(),e.on("error",function(t){u.onError(a,t.target)}).on("preReady",function(t){var e=u.elementInfos[a];e.hasLoading=t.hasLoading,e.isSkip=t.isSkip;var n=u.checkPreReady(a);u.onPreReadyElement(a),n&&u.onPreReady()}).on("ready",function(t){var e=t.withPreReady,n=t.hasLoading,i=t.isSkip,r=u.elementInfos[a];r.hasLoading=n,r.isSkip=i;var o=e&&u.checkPreReady(a),s=u.checkReady(a);e&&u.onPreReadyElement(a),u.onReadyElement(a),o&&u.onPreReady(),s&&u.onReady()}),{loader:e,element:t,hasLoading:!1,hasError:!1,isPreReady:!1,isReady:!1,isSkip:!1}});var e=this.elementInfos.length;return(this.totalCount=e)||setTimeout(function(){u.onPreReady(),u.onReady()}),this},e.getTotalCount=function(){return this.totalCount},e.isPreReady=function(){return this.elementInfos.every(function(t){return t.isPreReady})},e.isReady=function(){return this.elementInfos.every(function(t){return t.isReady})},e.hasError=function(){return 0<this.totalErrorCount},e.clear=function(){this.isPreReadyOver=!1,this.totalCount=0,this.preReadyCount=0,this.readyCount=0,this.totalErrorCount=0,this.elementInfos.forEach(function(t){!t.isReady&&t.loader&&t.loader.destroy()}),this.elementInfos=[]},e.destroy=function(){this.clear(),this.off()},e.getLoader=function(e,t){var n=this,i=e.tagName.toLowerCase(),r=this.options.loaders,o=Object.keys(r);if(r[i])return new r[i](e,t);var s=new wt(e,t),a=dt(e.querySelectorAll(o.join(", ")));s.setHasLoading(a.some(function(t){return pt(t)}));var u=!1,h=this.clone().on("error",function(t){s.onError(t.target)}).on("ready",function(){s.onReady(u)});return s.on("requestChildren",function(){var t=_t(e,o,n.options.prefix);h.check(t).on("preReady",function(t){(u=t.isReady)||s.onPreReady()})}).on("reqeustReadyChildren",function(){h.check(a)}).on("requestDestroy",function(){h.destroy()}),s},e.clone=function(){return new t(rt({},this.options))},e.checkPreReady=function(t){return this.elementInfos[t].isPreReady=!0,++this.preReadyCount,!(this.preReadyCount<this.totalCount)},e.checkReady=function(t){return this.elementInfos[t].isReady=!0,++this.readyCount,!(this.readyCount<this.totalCount)},e.onError=function(t,e){var n=this.elementInfos[t];n.hasError=!0,this.trigger("error",{element:n.element,index:t,target:e,errorCount:this.getErrorCount(),totalErrorCount:++this.totalErrorCount})},e.onPreReadyElement=function(t){var e=this.elementInfos[t];this.trigger("preReadyElement",{element:e.element,index:t,preReadyCount:this.preReadyCount,readyCount:this.readyCount,totalCount:this.totalCount,isPreReady:this.isPreReady(),isReady:this.isReady(),hasLoading:e.hasLoading,isSkip:e.isSkip})},e.onPreReady=function(){this.isPreReadyOver=!0,this.trigger("preReady",{readyCount:this.readyCount,totalCount:this.totalCount,isReady:this.isReady(),hasLoading:this.hasLoading()})},e.onReadyElement=function(t){var e=this.elementInfos[t];this.trigger("readyElement",{index:t,element:e.element,hasError:e.hasError,errorCount:this.getErrorCount(),totalErrorCount:this.totalErrorCount,preReadyCount:this.preReadyCount,readyCount:this.readyCount,totalCount:this.totalCount,isPreReady:this.isPreReady(),isReady:this.isReady(),hasLoading:e.hasLoading,isPreReadyOver:this.isPreReadyOver,isSkip:e.isSkip})},e.onReady=function(){this.trigger("ready",{errorCount:this.getErrorCount(),totalErrorCount:this.totalErrorCount,totalCount:this.totalCount})},e.getErrorCount=function(){return this.elementInfos.filter(function(t){return t.hasError}).length},e.hasLoading=function(){return this.elementInfos.some(function(t){return t.hasLoading})},t}(v),Pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return it(e,t),e.prototype.checkElement=function(){var t=this.element,e=t.getAttribute("src");return t.complete&&e?(t.naturalWidth||this.onAlreadyError(t),!1):(this.addEvents(),ut&&t.setAttribute("src",e),!0)},e.EVENTS=["load","error"],e}(Et),Rt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return it(e,t),e.prototype.checkElement=function(){var t=this.element;return!(1<=t.readyState)&&(t.error?(this.onAlreadyError(t),!1):(this.addEvents(),!0))},e.EVENTS=["loadedmetadata","error"],e}(Et),Mt=function(e){function t(t){return void 0===t&&(t={}),e.call(this,rt({loaders:{img:Pt,video:Rt}},t))||this}return it(t,e),t}(xt);function It(t,e){return~t.indexOf(e)}var Lt=function(){function t(t,e,n,i){this._infinite=t,this._itemManager=e,this._renderer=n,this.options=i}var e=t.prototype;return e.setLayout=function(t){this._layout=t},e.render=function(i,t,r,e){var o=this;void 0===r&&(r=J.pluck(t,"items"));var n=e?t:t.reverse(),s=[],a=[],u=r.map(function(t){return t.el}),h=this.options.attributePrefix,c=new Mt({prefix:h});return(this.im=c).check(u),c.on("preReady",function(){o._itemManager&&o._preReady(i,n,r,e)}).on("error",function(t){var e=t.target,n=t.index;o._itemManager&&o._error(i,a,s,e,r,n)}).on("readyElement",function(t){r[t.index].needUpdate=!1,t.hasLoading&&t.isPreReadyOver&&o._readyElement(i,r[t.index])}).on("ready",function(){o._itemManager&&o._ready(i,a,s,r)}),i},e.destroy=function(){this.im&&this.im.destroy()},e._preReady=function(t,e,n,r){var o=this,i=this._infinite,s=this._layout,a=this._itemManager,u=r?"end":"start",h=a.indexOf(e[0]),c=a.getGroup(h+(r?-1:1)),l=c?c.outlines[u]:[0];this._renderer.updateSize(n),e.forEach(function(t){var n=t.outlines[r?"start":"end"];if(!(!l.length||l.length!==n.length||!l.every(function(t,e){return t===n[e]})))return l=t.outlines[r?"end":"start"],void o._renderer.renderItems(t.items);var e=t.items,i=s[r?"append":"prepend"](e,l,!0);Y(t,i),o._renderer.renderItems(i.items),l=i.outlines[r?"end":"start"]});var f=Math.max(i.getCursor("start"),0),d=Math.max(i.getCursor("end"),0),p=a.indexOf(e[0].groupKey),g=a.indexOf(e[e.length-1].groupKey),v=!0;if((d+1<p||g<f-1)&&(v=!1),v&&(g=r?(p=f,Math.max(d,g)):(p=Math.max(Math.min(f,p),0),d)),g<p){var m=p;p=g,g=m}t.trigger("renderComplete",{start:p,end:g}),t.trigger("layoutComplete",{items:J.pluck(e,"items"),isAppend:!!r})},e._error=function(t,n,i,r,e,o){function s(){if(!It(n,f)){n.push(f);var t=i.indexOf(o);-1!==t&&i.splice(t,1)}}function a(){r!==f?It(n,f)||(r.parentNode.removeChild(r),l.content=f.outerHTML,It(i,o)||i.push(o)):s()}function u(t){if(!It(n,f)){if(t)if(K(t)||"object"==typeof t){var e=r.parentNode;e.insertBefore(j(t),r),e.removeChild(r),l.content=f.outerHTML}else r instanceof HTMLImageElement&&(r.src=t,r.getAttribute(d+"width")&&(r.removeAttribute(d+"width"),r.removeAttribute(d+"height")));l.content=f.outerHTML,It(i,o)||i.push(o)}}function h(t){It(n,f)||(f.innerHTML=t,l.content=f.outerHTML,It(i,o)||i.push(o))}var c=this._itemManager,l=e[o],f=l.el,d=this.options.attributePrefix,p=c.pluck("items").indexOf(l);r instanceof HTMLImageElement&&t.trigger("imageError",{target:r,element:f,items:e,item:l,itemIndex:o,replace:u,replaceItem:h,remove:a,removeItem:s,totalIndex:p}),t.trigger("contentError",{target:r,element:f,items:e,item:l,itemIndex:o,replace:u,replaceItem:h,remove:a,removeItem:s,totalIndex:p})},e._readyElement=function(t,e){t.trigger("readyElement",{item:e})},e._ready=function(t,e,n,i){var r=this,o=this.options.attributePrefix,s=e.length,a=n.length;if(s||a){var u=n.map(function(t){return i[t]});a?new Mt({prefix:o}).check(u.map(function(t){return t.el})).on("ready",function(){r._renderer.updateSize(u),t.trigger("ready",{remove:e,layout:!0})}):t.trigger("ready",{remove:e,layout:!0})}else t.trigger("ready",{remove:[]})},t}(),bt=function(){function t(t,e){var r=this;void 0===e&&(e={}),this._resizeTimer=0,this._maxResizeDebounceTimer=0,this._containerOffset=0,this._isScrollIssue=m,this._prevPos=null,this._onCheck=function(){var t=r.getScrollPos(),e=r.getOrgScrollPos();r.setScrollPos(e);var n=r.getScrollPos();null===t||r._isScrollIssue&&0===e||t===n?e&&(r._isScrollIssue=!1):(r._isScrollIssue=!1,r.options.check({isForward:t<n,scrollPos:n,orgScrollPos:e,horizontal:r.options.horizontal}))},this._onResize=function(){function t(){clearTimeout(r._resizeTimer),clearTimeout(r._maxResizeDebounceTimer),r._maxResizeDebounceTimer=0,r._resizeTimer=0,r.resize(),r.options.resize()}var e=r.options,n=e.resizeDebounce,i=e.maxResizeDebounce;!r._maxResizeDebounceTimer&&n<=i&&(r._maxResizeDebounceTimer=u.setTimeout(t,i)),r._resizeTimer&&(clearTimeout(r._resizeTimer),r._resizeTimer=0),r._resizeTimer=u.setTimeout(t,n)},Y(this.options={container:t,resize:function(){},check:function(){},isOverflowScroll:!1,horizontal:!1,resizeDebounce:100,maxResizeDebounce:0},e),this._view=t,this.attachEvent(),this.resize(),this.setScrollPos()}var e=t.prototype;return e.getStatus=function(){return{_prevPos:this._prevPos,scrollPos:this.getOrgScrollPos()}},e.setStatus=function(t,e){void 0===e&&(e=!0),this._prevPos=t._prevPos,e&&this.scrollTo(t.scrollPos)},e.scrollBy=function(t){var e=this.options.horizontal?[t,0]:[0,t];!function(t,e,n){Q(t)?t.scrollBy(e,n):(t.scrollLeft+=e,t.scrollTop+=n)}(this._view,e[0],e[1]),this.setScrollPos()},e.scrollTo=function(t){var e=this.options.horizontal?[t,0]:[0,t];!function(t,e,n){Q(t)?t.scroll(e,n):(t.scrollLeft=e,t.scrollTop=n)}(this._view,e[0],e[1])},e.getScrollPos=function(){return this._prevPos},e.setScrollPos=function(t){void 0===t&&(t=this.getOrgScrollPos()),this._prevPos=t-this.getContainerOffset()},e.attachEvent=function(){D(this._view,"scroll",this._onCheck),D(u,"resize",this._onResize)},e.getOrgScrollPos=function(){return function(t,e){void 0===e&&(e=!1);var n="scroll"+(e?"Left":"Top");return Q(t)?u[e?"pageXOffset":"pageYOffset"]||h.body[n]||h.documentElement[n]:t[n]}(this._view,this.options.horizontal)},e.reset=function(){this._prevPos=null},e.getContainerOffset=function(){return this._containerOffset},e.resize=function(){this._containerOffset=this.options.isOverflowScroll?0:this._getOffset()},e.detachEvent=function(){q(this._view,"scroll",this._onCheck),q(u,"resize",this._onResize)},e.destroy=function(){this.detachEvent(),this.reset()},e._getOffset=function(){var t=this.options,e=t.container,n=t.horizontal;return e.getBoundingClientRect()[n?"left":"top"]+this.getOrgScrollPos()},t}(),Ot=function(p){function t(t,e){var n=p.call(this)||this;n._loadingBar={},n._requestGroups=[],Y(n.options=g({},P),e),b&&(n.options.useFit=!1),C&&(n.options.isOverflowScroll=!1),n._reset();var i=n.options,r=i.isOverflowScroll,o=i.isEqualSize,s=i.isConstantSize,a=i.horizontal,u=i.threshold,h=i.useRecycle,c=i.attributePrefix,l=i.resizeDebounce,f=i.maxResizeDebounce,d=i.percentage;return n._itemManager=new J,n._renderer=new tt(t,{isEqualSize:o,isConstantSize:s,horizontal:a,container:r,percentage:d}),n._watcher=new bt(n._renderer.view,{resizeDebounce:l,maxResizeDebounce:f,isOverflowScroll:r,horizontal:a,container:n._renderer.container,resize:function(){return n._onResize()},check:function(t){return n._onCheck(t)}}),n._infinite=new et(n._itemManager,{useRecycle:h,threshold:u,append:function(t){return n._requestAppend(t)},prepend:function(t){return n._requestPrepend(t)},recycle:function(t){return n._recycle([t])}}),n._renderManager=new Lt(n._infinite,n._itemManager,n._renderer,{attributePrefix:c,isEqualSize:o,isConstantSize:s,horizontal:a}),n}!function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(t,p);var e=t.prototype;return e.append=function(t,e){return this._layout&&this._insert({elements:t,isAppend:!0,groupKey:e}),this},e.prepend=function(t,e){return this._layout&&this._insert({elements:t,isAppend:!1,groupKey:e}),this},e.setLayout=function(t,e){void 0===e&&(e={});var n=this.options.horizontal;return"function"==typeof t?this._layout=new t(Y(e,{horizontal:n})):(t.options.horizontal=n,this._layout=t),this._renderManager.setLayout(this._layout),this._renderer.resize(),this._setSize(this._renderer.getViewportSize()),this},e.getItems=function(t){return void 0===t&&(t=!1),t?this._itemManager.pluck("items"):this._infinite.getVisibleItems()},e.getRenderingItems=function(){var t=this.getItems(),e={};t.forEach(function(t){e[t.itemKey]=!0});var n=J.pluck(this._requestGroups,"items").filter(function(t){return!e[t.itemKey]&&(e[t.itemKey]=!0)});return t.concat(n)},e.beforeSync=function(t){return this._infinite.sync(t)},e.sync=function(i){var r=this,t=this._itemManager,e=this._infinite,n=this.getRenderingItems();if(n.forEach(function(t,e){var n=t.el!==i[e];t.el=i[e],n&&r._renderer.renderItem(t,t.rect)}),!this._isProcessing()){var o=n.filter(function(t){return t.needUpdate||!t.orgSize||!t.orgSize.width});if(o.length)this._postLayout({fromCache:!1,groups:e.getVisibleData(),newItems:o,isAppend:!0,isTrusted:!1});else if(t.size())if(e.getCursor("start")<0){var s=t.getGroup(0);this._postLayout({groups:[s],hasChildren:!1,fromCache:!1,isAppend:!0})}else this._infinite.scroll(this._watcher.getScrollPos());else this._requestAppend({})}},e.layout=function(t){if(void 0===t&&(t=!0),!this._layout)return this;var e=this._renderer,n=this._itemManager,i=this._infinite,r=e.resize(),o=this.getItems(),s=this.options,a=s.isEqualSize,u=s.isConstantSize,h=s.transitionDuration,c=t&&(a||u),l=n.size();if(this._watcher.resize(),t&&r&&this._setSize(e.getViewportSize()),!o.length){var f=G(e.container.children).filter(function(t){return-1===t.className.indexOf(E)}),d=0<f.length;if(l){var p=n.getGroup(0);d&&p.items.forEach(function(t,e){t.el=f[e]}),this._postLayout({groups:[p],hasChildren:d,fromCache:!1,isAppend:!0})}else if(d){var g=f[0].getAttribute("data-groupkey");"string"!=typeof g&&(g=void 0),this._insert({elements:f,isAppend:!0,hasChildren:!0,groupKey:g})}else e.getContainerSize()&&e.setContainerSize(0),this._requestAppend({});return this}var v=i.getCursors(),m=v[0],_=v[1],y=!c&&t&&r?n.sliceGroups(m,_+1):n.getGroups();return this._relayout(t,y,r?o:[]),c?this._fit():t&&r&&n.clearOutlines(m,_),this._renderer.renderItems(o,h),t&&this._watcher.setScrollPos(),this._onLayoutComplete({items:o,isAppend:!0,fromCache:!0,isTrusted:!1,useRecycle:!1,isLayout:!0}),this},e.removeByIndex=function(t,e,n){void 0===n&&(n=!0);var i=this._infinite.remove(t,e),r=i.items,o=i.group;return r.forEach(function(t){tt.removeElement(t.el)}),r.length?(n&&this.layout(!!o),r):[]},e.remove=function(t,e){void 0===e&&(e=!0);var n=this._itemManager.indexesOfElement(t),i=n.groupIndex,r=n.itemIndex;return this.removeByIndex(i,r,e)},e.getGroupKeys=function(t){return(t?this._itemManager.getGroups():this._infinite.getVisibleData()).map(function(t){return t.groupKey})},e.getStatus=function(t,e){return{_status:Y({},this._status),_itemManager:this._itemManager.getStatus(t,e),_renderer:this._renderer.getStatus(),_watcher:this._watcher.getStatus(),_infinite:this._infinite.getStatus(t,e)}},e.setStatus=function(t,e,n){if(void 0===e&&(e=!0),!t)return this;var i=t._status,r=t._renderer,o=t._itemManager,s=t._watcher,a=t._infinite;if(!(i&&r&&o&&s&&a))return this;var u=this.options.renderExternal,h=this._itemManager,c=this._renderer,l=this._watcher,f=this._infinite;l.detachEvent(),Y(this._status,i),this._status.processingStatus=0,h.setStatus(o),c.setStatus(r),f.setStatus(a);var d=this.getItems(),p=d.length;u?(d.forEach(function(t,e){t.el=n[e]}),this._renderer.renderItems(d)):c.createAndInsert(d,!0);var g=c.isNeededResize();l.setStatus(s,e),l.attachEvent();var v=this.options,m=v.isConstantSize,_=v.isEqualSize;return p?g?(c.resize(),this._setSize(c.getViewportSize()),m?this.layout(!0):(this._itemManager.clearOutlines(),this._postLayout({fromCache:!0,groups:_?h.getGroups():f.getVisibleData(),items:d,newItems:d,isAppend:!0,isTrusted:!1}))):this.layout(!1):this._requestAppend({cache:[]}),this},e.clear=function(){return this._itemManager.clear(),this._renderer.clear(),this._infinite.clear(),this._reset(),this._appendLoadingBar(),this},e.setLoadingBar=function(t){void 0===t&&(t={});var e="object"==typeof t?t:{append:t,prepend:t};this._status.loadingSize=0,this._status.loadingStyle={};var n,i,r,o,s=this._loadingBar,a=!1;for(var u in e){var h=j(e[u]);s[u]!==h&&(s[u]=h,a=!0),o=E,((r=h).classList?r.classList.contains(o):r.className.match(new RegExp("(\\s|^)"+o+"(\\s|$)")))||(i=E,(n=h).classList?n.classList.add(i):n.className+=" "+i)}return a&&this._renderLoading(),this._appendLoadingBar(),this},e.isProcessing=function(){return this._isProcessing()||this.isLoading()},e.isLoading=function(){return 0<this._getLoadingStatus()},e.getLoadingBar=function(t){return void 0===t&&(t=2!==this._getLoadingStatus()),this._loadingBar[t?"append":"prepend"]},e.startLoading=function(t,e){var n=this;if(void 0===e&&(e={display:"block"}),this.isLoading())return this;var i=t?"append":"prepend";if(this._process(t?1:2),!this._loadingBar[i])return this;function r(){n._renderLoading(e),n._status.loadingStyle=e,t?n._setContainerSize(n._getEdgeValue("end")+n._status.loadingSize):n._fit()}return this.options.renderExternal?this.trigger("render",{next:r}):r(),this},e.endLoading=function(t){var e;if(void 0===t&&(t={display:"none"}),!this.isLoading())return this;var n=1===this._getLoadingStatus(),i=n?"append":"prepend",r=this._loadingBar[i],o=this._status,s=o.loadingSize;if(this._process(3,!1),o.loadingSize=0,o.loadingStyle={},r){var a=Y(((e={})[this.options.horizontal?"left":"top"]=-s+"px",e),t);for(var u in a)r.style[u]=a[u];n?this._setContainerSize(this._getEdgeValue("end")):this._fitItems(s),this.options.renderExternal&&this.trigger("render",{next:function(){}})}return this.options.useRecycle&&!this.isProcessing()&&this._infinite.recycle(this._watcher.getScrollPos(),n),this},e.getItem=function(t,e){if(void 0===t&&(t=0),"object"!=typeof t){var n=this._itemManager.getGroup(t);return n&&n.items[e||0]}if(t)for(var i=this.getItems(),r=i.length,o=0;o<r;++o)if(i[o].el===t)return i[o]},e.updateItem=function(t,e){var n=this.getItem(t,e);return this._updateItem(n)&&this.layout(!1),this},e.updateItems=function(){var e=this;return this.getItems().forEach(function(t){e._updateItem(t)}),this.layout(!1),this},e.moveTo=function(t,o){var s=this;if(void 0===o&&(o=0),this.isProcessing())return this;var e=this._itemManager.getGroup(t);if(!e)return this;var n=this._infinite,i=e.outlines,a=e.items,r=a[o],u=i.start&&0===i.start.length,h=n.getCursors(),c=h[0],l=h[1],f=c<=t&&t<=l,d=this.options,p=d.useRecycle,g=d.horizontal;if(f||!p||!u){var v=r?r.rect[g?"left":"top"]:Math.max.apply(Math,i.start),m=Math.min.apply(Math,i.start);m<0&&(this._fitItems(m,0),v-=m);var _=c<t;return f||_?this._scrollTo(v):this._postLayout({fromCache:!0,groups:[e],items:a,newItems:[],isAppend:_,isTrusted:!1}).on("renderComplete",function(t){var e=t.start,n=t.end,i=s._itemManager;if(i){var r=a[o].rect[g?"left":"top"];f||i.clearOutlines(e,n),s._scrollTo(r),s._setScrollPos(r)}}),this}_=l<t||t<c-1;return this._postCache({isAppend:_,cache:[e],isTrusted:!1}).on("renderComplete",function(t){var e=t.start,n=t.end,i=s._itemManager;if(i){var r=a[o].rect[g?"left":"top"];i.clearOutlines(e,n),s._scrollTo(r),s._setScrollPos(r)}}),this},e.destroy=function(){this._infinite.clear(),this._watcher.destroy(),this._reset(),this._itemManager.clear(),this._renderer.destroy(),this._renderManager.destroy()},e._relayout=function(t,e,n){var i=this._renderer,r=i.options,o=r.isEqualSize,s=r.isConstantSize,a=e.filter(function(t){var e=t.items[0];return e.orgSize&&-1e4<e.rect.top});if(!a.length)return[];var u=a[0].outlines.start;t&&(u=[u.length?Math.min.apply(Math,u):0],!s&&n.length&&(i.updateSize(n),o&&n[0].size&&J.pluck(a,"items").forEach(function(t){t.size=Y({},n[0].size)}))),this._layout.layout(a,u)},e._setContainerSize=function(t){this._renderer.setContainerSize(Math.max(this._itemManager.getMaxEdgeValue(),t))},e._appendLoadingBar=function(){if(!this.options.renderExternal){var t=this._loadingBar,e=this._renderer.container;for(var n in t)e.appendChild(t[n])}},e._setSize=function(t){this._infinite.setSize(this._renderer.getViewSize()),this._layout.setSize(t)},e._fitItems=function(t,e){void 0===e&&(e=0),0<t&&this._watcher.scrollBy(-t),this._itemManager.fit(t,this.options.horizontal),this._renderer.renderItems(this.getItems()),this._setContainerSize(this._getEdgeValue("end")||e),t<0&&this._watcher.scrollBy(-t)},e._fit=function(t){void 0===t&&(t=this.options.useFit);var e=this._getEdgeValue("start"),n=2===this._getLoadingStatus()&&this._status.loadingSize||0,i=this.options,r=i.isConstantSize,o=i.isEqualSize;if(!i.useRecycle||!t||r||o)e<n&&this._fitItems(e-n,n),e=0;else{if(0===e&&!n)return 0;this._fitItems(e-n,n)}return this.isLoading()&&this._renderLoading(),e},e._getEdgeValue=function(t){return this._infinite.getEdgeValue(t)},e._isProcessing=function(){return 0<(4&this._status.processingStatus)},e._getLoadingStatus=function(){return 3&this._status.processingStatus},e._process=function(t,e){void 0===e&&(e=!0),e?this._status.processingStatus|=t:this._status.processingStatus-=this._status.processingStatus&t},e._insert=function(t){var e=t.elements,n=t.isAppend,i=t.hasChildren,r=t.groupKey,o=void 0===r?(new Date).getTime()+Math.floor(1e3*Math.random()):r;if(!this._isProcessing()&&0!==e.length){var s=J.toItems(j(e,!0),o);this._insertItems({items:s,isAppend:n,hasChildren:i,groupKey:o})}},e._insertItems=function(t){var e=t.items,n=t.isAppend,i=t.hasChildren,r=t.groupKey,o=void 0===r?(new Date).getTime()+Math.floor(1e3*Math.random()):r;if(e.length){var s=this._itemManager[n?"appendGroup":"prependGroup"]({groupKey:o,items:e});if(!n){var a=this._infinite,u=a.getCursors(),h=u[0],c=u[1];a.setCursor("start",h+1),a.setCursor("end",c+1)}this._postLayout({fromCache:!1,groups:[s],items:s.items,newItems:s.items,isAppend:n,hasChildren:i,isTrusted:!1})}},e._recycle=function(t){var r=this,e=this.options,n=e.useRecycle,o=e.renderExternal;if(!n)return!1;var s=!1;return t.forEach(function(t){var e=t.start,n=t.end;if(!(-1===e||-1===n||n<e)){var i=r._itemManager.pluck("items",e,n);s=s||i.some(function(t){return t.mounted}),i.forEach(function(t){t.mounted=!1}),o||tt.removeItems(i)}}),s&&(this._requestGroups=[],this.trigger("render",{next:function(){}})),s},e._renderLoading=function(t){if(void 0===t&&(t=this._status.loadingStyle),this.isLoading()){var e=1===this._getLoadingStatus(),n=this._loadingBar[e?"append":"prepend"];if(n){var i=Y({position:"absolute"},t);for(var r in i)n.style[r]=i[r];this._status.loadingSize=this.options.horizontal?N(n):X(n);var o=this.options.horizontal?"left":"top";if(!(o in i)){var s=e?this._getEdgeValue("end"):this._getEdgeValue("start")-this._status.loadingSize;n.style[o]=s+"px"}}}},e._updateItem=function(t){return!(!t||!t.el)&&(t.content=t.el.outerHTML,this.options.isEqualSize||function(t){t.orgSize=null,t.size=null}(t),this._renderer.updateSize([t]),!0)},e._setScrollPos=function(t){this._watcher.setScrollPos(this._watcher.getContainerOffset()+t)},e._scrollTo=function(t){this._watcher.scrollTo(this._watcher.getContainerOffset()+t)},e._postCache=function(t){var e=t.cache,n=t.isAppend,i=t.isTrusted,r=void 0===i||i,o=this.options.isConstantSize,s=J.pluck(e,"items"),a=!0,u=s.filter(function(t){return t.orgSize&&t.orgSize.width?!o&&t.rect.top<-1e4:!(a=!1)});return this._postLayout({fromCache:a,groups:e,items:s,newItems:u,isAppend:n,isTrusted:r})},e._postLayout=function(t){var r=this,n=t.fromCache,e=t.groups,i=t.items,o=void 0===i?J.pluck(e,"items"):i,s=t.newItems,a=t.isAppend,u=t.hasChildren,h=t.isTrusted;if(this._process(4),e.length){var c=this.options.renderExternal,l=this._renderer,f=new v,d=function(){o.forEach(function(t){t.mounted=!0}),r._renderManager.render(f,e,s,a).on("imageError",function(t){r.trigger("imageError",t)}).on("contentError",function(t){r.trigger("contentError",t)}).on("renderComplete",function(t){var e=t.start,n=t.end;r._setCursor(e,n)}).on("layoutComplete",function(t){var e=t.items;r._process(4,!1),r._onLayoutComplete({items:e,isAppend:a,fromCache:n,isTrusted:h,useRecycle:!1})}).on("readyElement",function(t){r._updateItem(t.item)&&r.layout(!1)}).on("ready",function(t){var e=t.remove,n=t.layout;if(e.forEach(function(t){return r.remove(t,!1)}),n)r.layout(!1);else if(!r.isProcessing()&&r.options.useRecycle){var i=r._watcher.getScrollPos();r._infinite.recycle(i,a)}})};if(!u){if(c)return o.every(function(t){return t.mounted})?d():(this._requestGroups=e,this.trigger("render",{next:function(){u||r._renderer.renderItems(o),d()}})),f;l.createAndInsert(o,a)}return d(),f}},e._requestAppend=function(t){var e=this,n=t.cache;this._isProcessing()||(n&&n.length?this._postCache({cache:n,isAppend:!0}):this.trigger("append",{isTrusted:!0,groupKey:this.getGroupKeys().pop()||"",startLoading:function(t){e.startLoading(!0,t)},endLoading:function(t){e.endLoading(t)}}))},e._requestPrepend=function(t){var e=this,n=t.cache;this._fit(this.options.useFit||!n||!n.length),this._isProcessing()||(n&&n.length?this._postCache({cache:n,isAppend:!1}):this.trigger("prepend",{isTrusted:!0,groupKey:this.getGroupKeys().shift(),startLoading:function(t){e.startLoading(!1,t)},endLoading:function(t){e.endLoading(t)}}))},e._onResize=function(){this.layout(!0)},e._setCursor=function(t,e){var n=this._infinite,i=n.getCursors(),r=i[0],o=i[1];n.setCursor("start",t),n.setCursor("end",e),this._recycle([{start:r,end:t-1},{start:e+1,end:o}])||(this._requestGroups=[],this.trigger("render",{next:function(){}}))},e._onCheck=function(t){var e=t.isForward,n=t.scrollPos,i=t.horizontal,r=t.orgScrollPos;this.trigger("change",{isForward:e,horizontal:i,scrollPos:n,orgScrollPos:r}),this._infinite.scroll(n)},e._onLayoutComplete=function(t){var e=this,n=t.items,i=t.isAppend,r=t.isTrusted,o=void 0!==r&&r,s=t.useRecycle,a=void 0===s?this.options.useRecycle:s,u=t.fromCache,h=void 0!==u&&u,c=t.isLayout,l=void 0!==c&&c,f=this._renderer.getViewSize();i?this.isLoading()&&this._renderLoading():this._fit();var d=this._watcher,p=d.getScrollPos();l||!a||this.isLoading()||this._infinite.recycle(p,i);var g=this._getEdgeValue("end");i&&(this._setContainerSize(g+this._status.loadingSize||0),"number"==typeof p&&0<p&&(m||this._scrollTo(p))),this.trigger("layoutComplete",{target:n.concat(),isAppend:!!i,isTrusted:o,fromCache:h,isLayout:l,isScroll:f<d.getContainerOffset()+g,scrollPos:p,orgScrollPos:d.getOrgScrollPos(),size:g,endLoading:function(t){e.endLoading(t)}}),this._infinite.scroll(p)},e._reset=function(){this._status={processingStatus:0,loadingSize:0,loadingStyle:{}}},t.VERSION="3.7.0",t}(v);function Tt(t,e,n){return function(t,e){for(var n=[],i=e;i;)n.push(i),i=t[i];return n.reverse(),n}(function(t,e,n){var i={},r={};r[e]=0;var o,s,a,u,h,c,l=new kt(function(t){return t.cost});for(l.push({value:e,cost:0});l.size();)for(var f in s=(o=l.pop()).value,a=o.cost,u=t(s)||{})h=a+u[f],c=r[f],(void 0===r[f]||h<c)&&(r[f]=h,l.push({value:f,cost:h}),i[f]=s);if(void 0!==r[n])return i;var d=["Could not find a path from ",e," to ",n,"."].join("");throw new Error(d)}(t,e,n),n)}var kt=function(){function t(t){this.content=[],this.scoreFunction=t}var e=t.prototype;return e.push=function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},e.pop=function(){var t=this.content[0],e=this.content.pop();return 0<this.content.length&&(this.content[0]=e,this.sinkDown(0)),t},e.size=function(){return this.content.length},e.bubbleUp=function(t){for(var e=t,n=this.content[e];0<e;){var i=Math.floor((e+1)/2)-1,r=this.content[i];if(!(this.scoreFunction(n)<this.scoreFunction(r)))break;this.content[i]=n,this.content[e]=r,e=i}},e.sinkDown=function(t){for(var e,n=this.content.length,i=this.content[t],r=this.scoreFunction(i);;){var o=2*(t+1),s=o-1,a=null;if(s<n){var u=this.content[s];(e=this.scoreFunction(u))<r&&(a=s)}if(o<n){var h=this.content[o];this.scoreFunction(h)<(null==a?r:e)&&(a=o)}if(null===a)break;this.content[t]=this.content[a],this.content[a]=i,t=a}},t}(),At=function(){function t(t){void 0===t&&(t={}),this.options=function(t,e){return Y({},R,t,e)}({margin:0,horizontal:!1,minSize:0,maxSize:0,column:[1,8]},t),this._style=function(t){return U[t?d:f]}(this.options.horizontal),this._size=0}var e=t.prototype;return e.setSize=function(t){return this._size=t,this},e.append=function(t,e,n){return this._insert(t,e,!0,n)},e.prepend=function(t,e,n){return this._insert(t,e,!1,n)},e.layout=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=[]);for(var n=t.length,i=e,r=0;r<n;++r){var o=t[r],s=this._layout(o.items,i,!0);i=(o.outlines=s).end}return this},e._layout=function(s,t,e){var a=this,n=this._style,u=n.size1,h=n.size2,c=s.length,i=this.options.column,l="object"==typeof i?i:[i,i],r=Tt(function(t){for(var e={},n=+t.replace(/[^0-9]/g,""),i=c+1,r=Math.min(n+l[0],i-1);r<i&&!(r-n>l[1]);++r){var o=a._getCost(s,n,r,u,h);null!==o&&(o<0&&r===i-1&&(o=0),e[""+r]=Math.pow(o,2))}return e},"0",""+c);return this._setStyle(s,r,t,e)},e._getSize=function(t,n,i){var e=this.options.margin,r=t.reduce(function(t,e){return t+e.orgSize[i]/e.orgSize[n]},0);return(this._size-e*(t.length-1))/r},e._getCost=function(t,e,n,i,r){var o=this._getSize(t.slice(e,n),i,r),s=this.options.minSize||0,a=this.options.maxSize||1/0;return isFinite(a)?o<s?Math.pow(o-s,2)+Math.pow(a,2):a<o?Math.pow(o-a,2)+Math.pow(a,2):Math.min(o-a,s-o):o<s?Math.max(Math.pow(s,2),Math.pow(o,2)):o-s},e._setStyle=function(t,e,n,i){var r;void 0===n&&(n=[]);for(var o=this._style,s=o.startPos1,a=o.size1,u=o.startPos2,h=o.size2,c=e.length,l=this.options.margin,f=n[0]||0,d=f,p=0,g=0;g<c-1;++g){for(var v=parseInt(e[g],10),m=parseInt(e[g+1],10),_=t.slice(v,m),y=_.length,z=this._getSize(_,a,h),S=d,C=0;C<y;++C){var E=(R=_[C]).orgSize[h]/R.orgSize[a]*z,w=0===C?0:_[C-1].rect,x=w?w[u]+w[h]+l:0;R.rect=((r={})[s]=S,r[u]=x,r[a]=z,r[h]=E,r)}d=f+(p+=l+z)}var P=t.length;if(i)return{start:[f],end:[d]};for(g=0;g<P;++g){var R;(R=t[g]).rect[s]-=p}return{start:[f-p],end:[f]}},e._insert=function(t,e,n,i){void 0===t&&(t=[]),void 0===e&&(e=[]);var r=i?t:function(t){return t.map(function(t){return Y({},t)})}(t);return{items:r,outlines:this._layout(r,e,n)}},t}();return Ot.JustifiedLayout=At,Ot});
//# sourceMappingURL=infinitegrid.justifiedlayout.min.js.map
